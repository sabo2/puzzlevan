/*! @license pzpr.js v3.5.2 (c) 2009-2015 sabo2, MIT license
 *   https://bitbucket.org/sabo2/pzprv3 */
pzpr.classmgr.makeCustom(["shikaku","aho"],{MouseEvent:{mouseinput:function(){this.owner.playmode?(this.mousestart||this.mousemove)&&(this.btn.Left&&this.isBorderMode()?this.inputborder():this.inputQsubLine()):this.owner.editmode&&this.mousestart&&this.inputqnum()}},KeyEvent:{enablemake:!0},Board:{hasborder:1},AreaRoomManager:{enabled:!0},Graphic:{hideHatena:!0,gridcolor_type:"DLIGHT",bordercolor_func:"qans",fontcolor:"white",fontErrcolor:"white",globalfontsizeratio:.85,circleratio:[.4,.4],paint:function(){this.drawBGCells(),this.drawDashedGrid(),this.drawBorders(),this.drawCircles(),this.drawNumbers(),this.drawBorderQsubs(),this.drawChassis(),this.drawTarget()},circlestrokecolor_func:"null",getCircleFillColor:function(a){return-1!==a.qnum?1===a.error?this.errcolor1:this.quescolor:null}},Encode:{decodePzpr:function(){this.decodeNumber16()},encodePzpr:function(){this.encodeNumber16()},decodeKanpen:function(){this.owner.fio.decodeCellQnum_kanpen()},encodeKanpen:function(){this.owner.fio.encodeCellQnum_kanpen()}},FileIO:{decodeData:function(){this.decodeCellQnum(),this.decodeBorderAns()},encodeData:function(){this.encodeCellQnum(),this.encodeBorderAns()},kanpenOpen:function(){this.decodeCellQnum_kanpen(),this.decodeAnsSquareRoom()},kanpenSave:function(){this.encodeCellQnum_kanpen(),this.encodeAnsSquareRoom()},decodeAnsSquareRoom:function(){for(var a=this.readLines(+this.readLine()),b=this.owner.board,c=[],d=0;d<a.length&&""!==a[d];d++){for(var e=a[d].split(" "),f=0;4>f;f++)isNaN(e[f])||(e[f]=2*+e[f]+1);for(var g=e[1];g<=e[3];g+=2)for(var h=e[0];h<=e[2];h+=2)c[b.getc(g,h).id]=d}this.rdata2Border(!1,c),b.rooms.reset()},encodeAnsSquareRoom:function(){var a=this.owner.board,b=a.getRoomInfo();this.datastr+=b.max+"\n";for(var c=1;c<=b.max;c++){var d=b.area[c].clist.getRectSize();this.datastr+=""+(d.y1>>1)+" "+(d.x1>>1)+" "+(d.y2>>1)+" "+(d.x2>>1)+" \n"}},kanpenOpenXML:function(){this.decodeCellQnum_shikaku_XMLBoard(),this.decodeAnsSquareRoom_XMLAnswer()},kanpenSaveXML:function(){this.encodeCellQnum_shikaku_XMLBoard(),this.encodeAnsSquareRoom_XMLAnswer()},decodeCellQnum_shikaku_XMLBoard:function(){this.decodeCellXMLBoard(function(a,b){b>=1?a.qnum=b:-1===b&&(a.qnum=-2)})},encodeCellQnum_shikaku_XMLBoard:function(){this.encodeCellXMLBoard(function(a){var b=0;return a.qnum>=1?b=a.qnum:-2===a.qnum&&(b=-1),b})},decodeAnsSquareRoom_XMLAnswer:function(){for(var a=this.xmldoc.querySelectorAll("answer area"),b=this.owner.board,c=[],d=0;d<a.length;d++)for(var e=a[d],f=2*+e.getAttribute("c0")-1,g=2*+e.getAttribute("r0")-1,h=2*+e.getAttribute("c1")-1,i=2*+e.getAttribute("r1")-1,j=f;h>=j;j+=2)for(var k=g;i>=k;k+=2)c[b.getc(j,k).id]=d;this.rdata2Border(!1,c),b.rooms.reset()},encodeAnsSquareRoom_XMLAnswer:function(){for(var a=this.xmldoc.querySelector("answer"),b=this.owner.board,c=b.getRoomInfo(),d=1;d<=c.max;d++){var e=c.area[d].clist.getRectSize();a.appendChild(this.createXMLNode("area",{r0:(e.y1>>1)+1,c0:(e.x1>>1)+1,r1:(e.y2>>1)+1,c1:(e.x2>>1)+1}))}}},AnsCheck:{checklist:["checkNoNumber","checkDoubleNumber","checkRoomRect@shikaku","checkAhoSquare@aho","checkLshapeArea@aho","checkNumberAndSize","checkBorderDeadend+"],checkAhoSquare:function(){this.checkAllArea(this.getRoomInfo(),function(a,b,c,d){return 0>d||d%3===0||a*b===c},"bkNotRect3")},checkLshapeArea:function(){for(var a=this.getRoomInfo(),b=1;b<=a.max;b++){var c=a.area[b].clist,d=c.getQnumCell();if(!d.isnull){var e=d.qnum;if(!(0>e||e%3!==0)){var f=c.getRectSize(),g=this.owner.board.cellinside(f.x1,f.y1,f.x2,f.y2).filter(function(c){return a.getRoomID(c)!==b}),h=g.getRectSize();if(!(g.length>0&&h.cols*h.rows===h.cnt)||f.x1!==h.x1&&f.x2!==h.x2||f.y1!==h.y1&&f.y2!==h.y2){if(this.failcode.add("bkNotLshape3"),this.checkOnly)break;c.seterr(1)}}}}}},FailCode:{bkNoNum:["数字の入っていない領域があります。","An area has no numbers."],bkNumGe2:["1つの領域に2つ以上の数字が入っています。","An area has plural numbers."],bkSizeNe:["数字と領域の大きさが違います。","The size of the area is not equal to the number."],bkNotRect:["四角形ではない領域があります。","An area is not rectangle."],bkNotRect3:["大きさが3の倍数ではないのに四角形ではない領域があります。","An area whose size is not multiples of three is not rectangle."],bkNotLshape3:["大きさが3の倍数である領域がL字型になっていません。","An area whose size is multiples of three is not L-shape."]}});