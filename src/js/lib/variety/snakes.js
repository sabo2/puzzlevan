/*! @license pzpr.js v3.5.2 (c) 2009-2015 sabo2, MIT license
 *   https://bitbucket.org/sabo2/pzprv3 */
pzpr.classmgr.makeCustom(["snakes"],{MouseEvent:{mouseinput:function(){this.owner.playmode?(this.mousestart||this.mousemove)&&(this.inputDot_snakes()||this.dragnumber_snakes()):this.owner.editmode&&(this.mousestart||this.mousemove&&this.notInputted())&&this.inputdirec(),this.mouseend&&this.notInputted()&&this.inputqnum_snakes()},dragnumber_snakes:function(){var a=this.getcell();a.isnull||a===this.mouseCell||(this.mouseCell.isnull?(this.inputData=-1!==a.anum?a.anum:10,this.mouseCell=a):-1===a.qnum&&this.inputData>=1&&this.inputData<=5?(this.btn.Left?this.inputData++:this.btn.Right&&this.inputData--,this.inputData>=1&&this.inputData<=5&&(a.setQdir(0),a.setAnum(this.inputData),a.setQsub(0),this.mouseCell=a,a.draw())):-1===a.qnum&&10===this.inputData&&(a.setAnum(-1),a.setQsub(0),a.draw()))},inputDot_snakes:function(){if(!this.btn.Right||null!==this.inputData&&this.inputData>=0)return!1;var a=this.getcell();return a.isnull||a===this.mouseCell?this.inputData<0:null===this.inputData?-1===a.anum?(this.inputData=1!==a.qsub?-2:-3,!0):!1:(a.setAnum(-1),a.setQsub(-2===this.inputData?1:0),a.draw(),this.mouseCell=a,!0)},inputqnum_snakes:function(){var a=this.getcell();a.isnull||(this.mouseCell=this.owner.board.emptycell,this.inputqnum())}},KeyEvent:{enablemake:!0,enableplay:!0,moveTarget:function(a){return a.match(/shift/)?!1:this.moveTCell(a)},keyinput:function(a){this.owner.editmode&&this.key_inputdirec(a)||(!this.owner.playmode||"q"!==a&&"-"!==a||(a="s1"),this.key_inputqnum(a))}},Cell:{maxnum:5,minnum:function(){return this.owner.playmode?1:0},draw:function(){this.owner.getConfig("snakebd")?this.owner.painter.paintRange(this.bx-2,this.by-2,this.bx+2,this.by+2):this.getaddr().draw()}},Board:{hasborder:1,getSnakeInfo:function(){for(var a=new this.owner.AreaInfo,b=0;b<this.cellmax;b++)a.id[b]=this.cell[b].anum>0?0:-1;for(var b=0;b<this.cellmax;b++){var c=this.cell[b];if(0===a.id[c.id]){for(var d=a.addArea(),e=[c],f=0;e.length>0;){var g=e.pop();if(0===a.id[g.id]){d.clist[f++]=g,a.id[g.id]=d.id;for(var h=g.getdir4clist(),i=0;i<h.length;i++){var j=h[i][0];1===Math.abs(g.anum-j.anum)&&e.push(j)}}}d.clist.length=f}}return a}},BoardExec:{adjustBoardData:function(a,b){this.adjustNumberArrow(a,b)}},Flags:{use:!0},Graphic:{hideHatena:!0,gridcolor_type:"LIGHT",dotcolor_type:"PINK",cellcolor_func:"qnum",fontcolor:"white",fontErrcolor:"white",paint:function(){this.drawBGCells(),this.drawDotCells(!0),this.drawDashedGrid(),this.drawBorders(),this.drawShadedCells(),this.drawArrowNumbers(),this.drawAnswerNumbers(),this.drawChassis(),this.drawCursor()},getBorderColor:function(a){if(!this.owner.getConfig("snakebd"))return!1;var b=a.sidecell[0],c=a.sidecell[1];return b.isnull||c.isnull||-1!==b.qnum||-1!==c.qnum||-1===b.anum&&-1===c.anum||!(-1===b.anum^-1===c.anum||1!==Math.abs(b.anum-c.anum))?null:this.borderQanscolor},drawAnswerNumbers:function(){for(var a=this.vinc("cell_number","auto"),b=this.range.cells,c=0;c<b.length;c++){var d=b[c];a.vid="cell_ansnum_"+d.id,-1===d.qnum&&d.anum>0?(a.fillStyle=this.fontAnscolor,this.disptext(""+d.anum,d.bx*this.bw,d.by*this.bh)):a.vhide()}}},Encode:{decodePzpr:function(){this.decodeArrowNumber16()},encodePzpr:function(){this.encodeArrowNumber16()}},FileIO:{decodeData:function(){this.decodeCellDirecQnum(),this.decodeCellAnumsub()},encodeData:function(){this.encodeCellDirecQnum(),this.encodeCellAnumsub()}},AnsCheck:{checklist:["checkSnakeSize","checkOtherAnsNumberInRoom","checkSideCell_snakes","checkArrowNumber","checkSnakesView"],getSnakeInfo:function(){return this._info.snake=this._info.snake||this.owner.board.getSnakeInfo()},checkSnakeSize:function(){this.checkAllArea(this.getSnakeInfo(),function(a,b,c){return 5===c},"bkSizeNe5")},checkOtherAnsNumberInRoom:function(){this.checkDifferentNumberInRoom_main(this.getSnakeInfo(),this.isDifferentAnsNumberInClist)},checkSideCell_snakes:function(){function a(a,b,c){var d=a.getRoomID(b),e=a.getRoomID(c);return d>0&&e>0&&d!==e}for(var b=!0,c=this.owner.board,d=this.getSnakeInfo(),e=0;e<c.cellmax;e++){var f=c.cell[e],g=f.adjacent.right;if(!g.isnull&&a(d,f,g)){if(b=!1,this.checkOnly)break;d.getRoomByCell(f).clist.seterr(1),d.getRoomByCell(g).clist.seterr(1)}if(g=f.adjacent.bottom,!g.isnull&&a(d,f,g)){if(b=!1,this.checkOnly)break;d.getRoomByCell(f).clist.seterr(1),d.getRoomByCell(g).clist.seterr(1)}}b||this.failcode.add("bsSnake")},checkArrowNumber:function(){function a(){return i=j.getc(),!i.isnull&&-1===i.qnum&&-1===i.anum}function b(a){return a.isnull||-1!==a.qnum||-1===a.anum}for(var c=!0,d=this.owner.board,e=0;e<d.cellmax;e++){var f=d.cell[e],g=f.qnum,h=f.qdir;if(!(0>g||0===h)){var i,j=f.getaddr();for(j.movedir(h,2);a();)j.movedir(h,2);if(0!==g||b(i)){if(g>0&&(b(i)||i.anum!==g)){if(c=!1,this.checkOnly)break;f.seterr(1),i.seterr(1)}}else{if(c=!1,this.checkOnly)break;f.seterr(1),0>=g&&i.seterr(1)}}}c||this.failcode.add("anNumberNe")},checkSnakesView:function(a){for(var a=this.getSnakeInfo(),b=1;b<=a.max;b++){var c=a.area[b].clist,d=c.filter(function(a){return 1===a.anum})[0];if(d){var e,f=d.NDIR,g=d.adjacent;if(e=g.bottom,e.isnull||2!==e.anum||(f=d.UP),e=g.top,e.isnull||2!==e.anum||(f=d.DN),e=g.right,e.isnull||2!==e.anum||(f=d.LT),e=g.left,e.isnull||2!==e.anum||(f=d.RT),f!==d.NDIR){var h=d.getaddr(),i=new this.owner.CellList;for(i.add(d);!d.isnull&&(h.movedir(f,2),d=h.getc(),d.isnull||i.add(d),!d.isnull&&-1===d.qnum&&-1===d.anum););var j=a.getRoomID(d);if(!(d.isnull||d.anum<=0||-1!==d.qnum||0>=j||b===j)){if(this.failcode.add("snakeAttack"),this.checkOnly)break;i.seterr(1),c.seterr(1),a.area[j].clist.seterr(1)}}}}}},FailCode:{bkDupNum:["同じ数字が入っています。","A Snake has same plural marks."],bkSizeNe5:["大きさが５ではない蛇がいます。","The size of a snake is not five."],bsSnake:["別々の蛇が接しています。","Other snakes are adjacent."],anNumberNe:["矢印の方向に境界線がありません。","There is no border in front of the arrowed number."],snakeAttack:["蛇の視線の先に別の蛇がいます。","A snake can see another snake."]}});