/*! @license pzpr.js v3.5.2 (c) 2009-2015 sabo2, MIT license
 *   https://bitbucket.org/sabo2/pzprv3 */
pzpr.classmgr.makeCustom(["amibo"],{MouseEvent:{mouseinput:function(){this.owner.playmode?((this.mousestart||this.mousemove)&&(this.btn.Left?this.inputTateyoko():this.btn.Right&&this.inputpeke()),this.mouseend&&this.notInputted()&&this.clickTateyoko()):this.owner.editmode&&this.mousestart&&this.inputqnum()},clickTateyoko:function(){var a=this.getcell();a.isnull||a.isNum()||(a.setQans((this.btn.Left?{0:12,12:13,13:11,11:0}:{0:11,11:13,13:12,12:0})[a.qans]),a.draw())}},KeyEvent:{enablemake:!0},Cell:{numberRemainsUnshaded:!0,maxnum:function(){var a=this.owner.board,b=this.bx,c=this.by,d=(b<a.maxbx>>1?a.maxbx-b:b)>>1,e=(c<a.maxby>>1?a.maxby-c:c)>>1;return Math.max(d,e)},minnum:2},Board:{hasborder:1,qcols:8,qrows:8,initialize:function(){this.common.initialize.call(this),this.barinfo=this.addInfoList(this.owner.AreaBarManager)},irowakeRemake:function(){this.barinfo.newIrowake()},getBarInfo:function(){return this.barinfo.getBarInfo()}},BoardExec:{adjustBoardData:function(a){if(a&this.TURN)for(var b={0:0,11:11,12:13,13:12},c=this.owner.board.cell,d=0;d<c.length;d++){var e=c[d];e.setQans(b[e.qans])}}},"AreaBarManager:AreaManager":{enabled:!0,relation:["cell"],isvalid:function(a){return a.qans>0},rebuild:function(){this.owner.AreaManager.prototype.rebuild.call(this),this.newIrowake()},calcLinkInfo:function(a){return this.linkinfo[a.id]={0:0,11:31,12:19,13:28}[a.qans]},irowakeEnable:function(){return this.owner.flags.irowake},irowakeValid:function(){return this.owner.getConfig("irowake")},getNewColor:function(){return this.owner.painter.getNewLineColor()},getBarInfo:function(){function a(a,b){var c=a.qans,e=11===c||c===(b?12:13);!f&&e?(f=d.addArea(),f.vert=b,null!==g&&d.pole[g.id].push(f.id)):f&&!e&&(d.pole[a.id].push(f.id),f=null),f&&e&&(f.clist.add(a),d.id[a.id].push(f.id)),g=a}for(var b=this.owner,c=b.board,d=new b.AreaBarInfo,e=c.minbx+1;e<=c.maxbx-1;e+=2)for(var f=null,g=null,h=c.minby+1;h<=c.maxby-1;h+=2)a(c.getc(e,h),!0);for(var h=c.minby+1;h<=c.maxby-1;h+=2)for(var f=null,g=null,e=c.minbx+1;e<=c.maxbx-1;e+=2)a(c.getc(e,h),!1);for(var i=0;i<c.cellmax;i++)if(2===d.id[i].length&&(d.area[d.id[i][0]].link.push(d.id[i][1]),d.area[d.id[i][1]].link.push(d.id[i][0])),c.cell[i].isNum())for(var j=0;j<d.pole[i].length;j++)d.area[d.pole[i][j]].pole.push(i);else d.pole[i]=[];return d}},"AreaBarInfo:AreaInfo":{initialize:function(){this.owner.AreaInfo.prototype.initialize.call(this),this.pole=[];for(var a=0,b=this.owner.board.cellmax;b>a;a++)this.id[a]=[],this.pole[a]=[]},addArea:function(){var a=++this.max;return this.area[a]={clist:new this.owner.CellList,id:a,link:[],pole:[],vert:!1}}},CellList:{setErrorBar:function(a){for(var b=0;b<this.length;b++){var c=this[b],d=c.error;4===d||(5===d?a||c.seterr(4):6===d?a&&c.seterr(4):c.seterr(a?5:6))}}},ObjectOperation:{decode:function(a){var b=this.common.decode.call(this,a);return this.old=[0,12,13,11][this.old],this.num=[0,12,13,11][this.num],b}},Flags:{irowake:!0},Graphic:{hideHatena:!0,gridcolor_type:"LIGHT",linecolor_type:"LIGHT",fontcolor:"black",fontErrcolor:"black",globalfontsizeratio:.85,circleratio:[.45,.4],setRange:function(a,b,c,d){this.common.setRange.call(this,a-2,b-2,c+2,d+2)},paint:function(){this.drawBGCells(),this.drawDashedGrid(),this.drawTateyokos(),this.drawTateyokos_sub(),this.drawCircles(),this.drawNumbers(),this.drawPekeBorder(),this.drawChassis(),this.drawTarget()},drawTateyokos_sub:function(){var a=this.vinc("cell_tateyoko","crispEdges",!0);a.fillStyle=this.linecolor;for(var b=this.range.cells,c=this.bw,d=this.bh,e=0;e<b.length;e++){var f=b[e],g=f.isNum(),h=Math.max(c/3,3),i=c-h/2,j=f.bx*c,k=f.by*d,l=f.adjacent.top,m=l.qans;a.vid="c_bars1a_"+f.id,!g||11!==m&&12!==m?a.vhide():(a.fillStyle=this.getBarColor(l,!0),a.fillRect(j-c+i,k-d,h,d));var l=f.adjacent.bottom,m=l.qans;a.vid="c_bars1b_"+f.id,!g||11!==m&&12!==m?a.vhide():(a.fillStyle=this.getBarColor(l,!0),a.fillRect(j-c+i,k+1,h,d));var l=f.adjacent.left,m=l.qans;a.vid="c_bars2a_"+f.id,!g||11!==m&&13!==m?a.vhide():(a.fillStyle=this.getBarColor(l,!1),a.fillRect(j-c,k-d+i,c,h));var l=f.adjacent.right,m=l.qans;a.vid="c_bars2b_"+f.id,!g||11!==m&&13!==m?a.vhide():(a.fillStyle=this.getBarColor(l,!1),a.fillRect(j+1,k-d+i,c,h))}},drawPekeBorder:function(){var a=this.vinc("border_pbd","crispEdges",!0);a.fillStyle=this.borderQsubcolor2;for(var b=.6*this.bw,c=this.lm,d=this.range.borders,e=0;e<d.length;e++){var f=d[e];if(a.vid="b_qsub2_"+f.id,2===f.qsub){var g=f.bx*this.bw,h=f.by*this.bh;f.isVert()?a.fillRectCenter(g,h,c,b+c):a.fillRectCenter(g,h,b+c,c)}else a.vhide()}}},Encode:{decodePzpr:function(){this.decodeNumber10()},encodePzpr:function(){this.encodeNumber10()}},FileIO:{decodeData:function(){this.decodeCell(function(a,b){"l"===b?a.qans=12:"-"===b?a.qans=13:"+"===b?a.qans=11:"#"===b?a.qnum=-2:"."!==b&&(a.qnum=+b)}),this.decodeBorderLine()},encodeData:function(){this.encodeCell(function(a){return 12===a.qans?"l ":13===a.qans?"- ":11===a.qans?"+ ":a.qnum>=0?a.qnum+" ":-2===a.qnum?"# ":". "}),this.encodeBorderLine()}},AnsCheck:{checklist:["checkNotMultiBar","checkLoop_amibo","checkLongBar","checkCrossedLength","checkShortBar","checkSingleBar","checkAllBarConnect+"],getBarInfo:function(){return this._info.bar=this._info.bar||this.owner.board.getBarInfo()},getConnectionInfo:function(){return this._info.bararea=this._info.bararea||this.owner.board.barinfo.getAreaInfo()},checkNotMultiBar:function(){this.checkOutgoingBars(1,"nmLineGt1")},checkSingleBar:function(){this.checkOutgoingBars(2,"nmNoLine")},checkOutgoingBars:function(a,b){for(var c=this.owner.board,d=this.getBarInfo(),e=0;e<c.cellmax;e++){var f=c.cell[e];if(f.isNum()){var g=d.pole[e];if(!(1===a&&g.length<=1||2===a&&g.length>0)){if(this.failcode.add(b),this.checkOnly)break;f.seterr(1)}}}},checkLongBar:function(){this.checkPoleLength(1,"lbLenGt")},checkShortBar:function(){this.checkPoleLength(2,"lbLenLt")},checkPoleLength:function(a,b){var c=!0,d=this.owner.board,e=this.getBarInfo();a:for(var f=0;f<d.cellmax;f++){var g=d.cell[f];if(g.isValidNum())for(var h=0,i=e.pole[f].length;i>h;h++){var j=g.getNum(),k=e.pole[f][h],l=e.area[k],m=l.clist,n=m.length;if(!(1===a&&j>=n||2===a&&n>=j)){if(c=!1,this.checkOnly)break a;g.seterr(1),m.setErrorBar(l.vert)}}}c||(this.failcode.add(b),d.cell.filter(function(a){return a.noNum()}).setnoerr())},checkCrossedLength:function(){for(var a=!0,b=this.getBarInfo(),c=1,d=b.max;d>=c;c++){for(var e=!1,f=b.area[c],g=f.link,h=f.clist,i=0,j=g.length;j>i;i++)if(h.length===b.area[g[i]].clist.length){e=!0;break}if(!e){if(a=!1,this.checkOnly)break;h.setErrorBar(f.vert)}}a||(this.failcode.add("lbNotCrossEq"),this.owner.board.cell.filter(function(a){return a.noNum()}).setnoerr())},checkAllBarConnect:function(){this.checkOneArea(this.getConnectionInfo(),"lbDivide")},checkLoop_amibo:function(){for(var a={cell:[]},b=this.owner.board,c=0;c<b.cellmax;c++)a.cell[c]=b.barinfo.getLinkCell(b.cell[c]);for(var d=[],c=0;c<b.cellmax;c++)d[c]=0!==b.cell[c].qans?0:null;for(var c=0;c<b.cellmax;c++)0===d[c]&&this.searchloop(c,a,d);var e=b.cell.filter(function(a){return 1===d[a.id]});e.length>0&&(this.failcode.add("lbLoop"),b.cell.filter(function(a){return a.noNum()}).setnoerr(),e.seterr(4))},searchloop:function(a,b,c){for(var d=[],e=[a],f=0;f<this.owner.board.cellmax;f++)d[f]=!1;for(;e.length>0;){var f=e[e.length-1];d[f]=!0;var g=b.cell[f].length>0?b.cell[f][0]:null;if(null!==g){for(var h=0;h<b.cell[f].length;h++)b.cell[f][h]===g&&b.cell[f].splice(h,1);for(var h=0;h<b.cell[g].length;h++)b.cell[g][h]===f&&b.cell[g].splice(h,1);if(d[g]){c[g]=1;for(var h=e.length-1;h>=0&&e[h]!==g;h--)c[e[h]]=1}else e.push(g)}else{var i=e.pop();0===c[i]&&(c[i]=2)}}}},FailCode:{lbDivide:["棒が１つに繋がっていません。","Bars are devided."],lbLenGt:["白丸から出る棒の長さが長いです。","The length of the bar is long."],lbLenLt:["白丸から出る棒の長さが短いです。","The length of the bar is short."],lbLoop:["棒で輪っかができています。","There is a looped bars."],lbNotCrossEq:["同じ長さの棒と交差していません。","A bar doesn't cross the bar whose length is the same."],nmLineGt1:["白丸に線が2本以上つながっています。","Prural lines connect to a white circle."],nmNoLine:["白丸に線がつながっていません。","No bar connects to a white circle."]}});