/*! @license pzpr.js v3.5.2 (c) 2009-2015 sabo2, MIT license
 *   https://bitbucket.org/sabo2/pzprv3 */
pzpr.classmgr.makeCustom(["icebarn","icelom","icelom2"],{MouseEvent:{mouseinput:function(){this.owner.playmode?this.btn.Left?this.mousestart||this.mousemove?this.inputLine():this.mouseend&&this.notInputted()&&this.inputpeke():this.btn.Right&&(this.mousestart||this.mousemove)&&this.inputpeke():this.owner.editmode&&(this.mousestart||this.mousemove?this.btn.Left?this.inputarrow():this.btn.Right&&this.inputIcebarn():"icebarn"!==this.owner.pid&&this.mouseend&&this.notInputted()&&this.inputqnum())},inputIcebarn:function(){var a=this.getcell();if(!a.isnull&&a!==this.mouseCell){if("icebarn"!==this.owner.pid&&a.isNum())return void this.inputqnum();null===this.inputData&&(this.inputData=a.ice()?0:6),a.setQues(this.inputData),a.drawaround(),this.mouseCell=a}},inputarrow:function(){var a=this.getpos(0);if(!this.prevPos.equals(a)){var b=this.getnb(this.prevPos,a);if(!b.isnull&&!this.mousestart){var c=this.getdir(this.prevPos,a);b.id<this.owner.board.bdinside?"icebarn"===this.owner.pid&&(null===this.inputData&&(this.inputData=b.getArrow()!==c?1:0),b.setArrow(1===this.inputData?c:0)):null===this.inputData&&this.inputarrow_inout(b,c),b.draw()}this.prevPos=a}},inputarrow_inout:function(a,b){var c=this.checkinout(a,b),d=this.owner.board;1===c?(d.arrowin.input(a),this.mousereset()):2===c&&(d.arrowout.input(a),this.mousereset())},checkinout:function(a,b){if(a.isnull)return 0;var c=this.owner.board,d=a.bx,e=a.by;return d===c.minbx&&b===a.RT||d===c.maxbx&&b===a.LT||e===c.minby&&b===a.DN||e===c.maxby&&b===a.UP?1:d===c.minbx&&b===a.LT||d===c.maxbx&&b===a.RT||e===c.minby&&b===a.UP||e===c.maxby&&b===a.DN?2:0}},"KeyEvent@icelom,icelom2":{enablemake:!0,keyinput:function(a){this.key_inputIcebarn(a)||this.key_inputqnum(a)},key_inputIcebarn:function(a){var b=this.cursor.getc();if("q"===a)b.setQues(b.ice()?0:6);else{if(" "!==a||!b.noNum())return!1;b.setQues(0)}return b.drawaround(),this.prev=b,!0}},Border:{getArrow:function(){return this.qdir},setArrow:function(a){this.setQdir(a)},isArrow:function(){return this.qdir>0}},"CellList@icebarn":{join:function(a){for(var b=[],c=0;c<this.length;c++)b.push(this[c].id);return b.join(a)}},Board:{qcols:8,qrows:8,hasborder:2,arrowin:null,arrowout:null,initialize:function(){this.common.initialize.call(this);var a=this.owner;this.arrowin=new a.InAddress(2,0),this.arrowout=new a.OutAddress(4,0),this.arrowin.partner=this.arrowout,this.arrowout.partner=this.arrowin,this.iceinfo=this.addInfoList(a.AreaIcebarnManager)},initBoardSize:function(a,b){this.common.initBoardSize.call(this,a,b),this.disableInfo(),a>=3?(this.arrowin.init(this.minbx+1,this.minby),this.arrowout.init(this.minbx+5,this.minby)):(this.arrowin.init(1,this.minby),this.arrowout.init(1,this.maxby)),this.enableInfo()},exchangeinout:function(){var a=this.arrowin.getb(),b=this.arrowout.getb();a.setArrow(0),b.setArrow(0),this.arrowin.set(b),this.arrowout.set(a),this.arrowin.draw(),this.arrowout.draw()},getTraceInfo:function(){var a=this.arrowin.getb(),b=a.qdir,c=a.getaddr(),d={lastcell:this.emptycell,lastborder:a,blist:new this.owner.BorderList,dir:b,count:1};for(d.blist.add(a);;)if(c.movedir(b,1),c.oncell()){var e=d.lastcell=c.getc();if(e.isnull)break;if(!e.ice()){var f=e.adjborder;2!==e.lcnt||(1!==b&&f.bottom.isLine()?b=2:2!==b&&f.top.isLine()?b=1:3!==b&&f.right.isLine()?b=4:4!==b&&f.left.isLine()&&(b=3)),d.dir=b}if("icebarn"!==this.owner.pid){var g=e.getNum();if(-1!==g){if(-2!==g&&g!==d.count)break;d.count++}}}else{if(a=d.lastborder=c.getb(),!a.isLine())break;d.blist.add(a);var h=a.getArrow();if(h!==a.NDIR&&b!==h)break}return d}},BoardExec:{posinfo_in:{},posinfo_out:{},adjustBoardData:function(a,b){var c=this.owner.board;this.adjustBorderArrow(a,b),this.posinfo_in=this.getAfterPos(a,b,c.arrowin.getb()),this.posinfo_out=this.getAfterPos(a,b,c.arrowout.getb())},adjustBoardData2:function(a){var b,c=this.owner,d=c.board,e=c.opemgr,f=this.posinfo_in,g=this.posinfo_out;b=a&this.REDUCE&&f.isdel&&!e.undoExec&&!e.redoExec,b&&(e.forceRecord=!0),d.arrowin.set(f.pos),b&&(e.forceRecord=!1),b=a&this.REDUCE&&g.isdel&&!e.undoExec&&!e.redoExec,b&&(e.forceRecord=!0),d.arrowout.set(g.pos),b&&(e.forceRecord=!1)}},"InOutAddress:Address":{type:"",partner:null,init:function(a,b){return this.bx=a,this.by=b,this.owner.board&&this.setarrow(this.getb()),this},getid:function(){return this.getb().id},setid:function(a){this.input(this.owner.board.border[a])},geturlid:function(){return this.getb().id-this.owner.board.bdinside},seturlid:function(a){var b=this.owner.board;this.input(b.border[a+b.bdinside])},input:function(a){this.partner.equals(a)?this.owner.board.exchangeinout():this.equals(a)||(this.getb().setArrow(0),this.set(a))},set:function(a){var b=this.getaddr();this.addOpe(a.bx,a.by),this.bx=a.bx,this.by=a.by,this.setarrow(this.getb()),b.draw(),this.draw()},addOpe:function(a,b){(this.bx!==a||this.by!==b)&&this.owner.opemgr.add(new this.owner.InOutOperation(this.type,this.bx,this.by,a,b))}},"InAddress:InOutAddress":{type:"in",setarrow:function(a){var b=this.owner.board;a.by===b.maxby?a.setArrow(a.UP):a.by===b.minby?a.setArrow(a.DN):a.bx===b.maxbx?a.setArrow(a.LT):a.bx===b.minbx&&a.setArrow(a.RT)}},"OutAddress:InOutAddress":{type:"out",setarrow:function(a){var b=this.owner.board;a.by===b.minby?a.setArrow(a.UP):a.by===b.maxby?a.setArrow(a.DN):a.bx===b.minbx?a.setArrow(a.LT):a.bx===b.maxbx&&a.setArrow(a.RT)}},"InOutOperation:Operation":{property:"",setData:function(a,b,c,d,e){this.property=a,this.bx1=b,this.by1=c,this.bx2=d,this.by2=e},decode:function(a){return"PI"!==a[0]&&"PO"!==a[0]?!1:(this.property="PI"===a[0]?"in":"out",this.bx1=+a[1],this.by1=+a[2],this.bx2=+a[3],this.by2=+a[4],!0)},toString:function(){return["in"===this.property?"PI":"PO",this.bx1,this.by1,this.bx2,this.by2].join(",")},undo:function(){this.exec(this.bx1,this.by1)},redo:function(){this.exec(this.bx2,this.by2)},exec:function(a,b){var c=this.owner.board,d=c.getb(a,b);"in"===this.property?c.arrowin.set(d):"out"===this.property&&c.arrowout.set(d)}},OperationManager:{initialize:function(){this.common.initialize.call(this),this.operationlist.push(this.owner.InOutOperation)}},LineManager:{isCenterLine:!0,isLineCross:!0},"AreaIcebarnManager:AreaManager":{enabled:!0,relation:["cell"],isvalid:function(a){return a.ice()}},Flags:{redline:!0,irowake:!0},Graphic:{gridcolor_type:"LIGHT",linecolor_type:"LIGHT",bgcellcolor_func:"icebarn",bordercolor_func:"ice",errcolor1:"red",fontShadecolor:"black",maxYdeg:.7,paint:function(){this.drawBGCells(),this.drawDashedGrid(),this.drawBorders(),this.drawLines(),this.drawPekes(),"icebarn"!==this.owner.pid&&this.drawNumbers(),this.drawBorderArrows(),this.drawChassis(),"icebarn"!==this.owner.pid&&this.drawTarget(),this.drawInOut()},getCanvasCols:function(){var a=this.owner.board,b=this.getBoardCols()+2*this.margin;return pzpr.PLAYER?((a.arrowin.bx===a.minbx||a.arrowout.bx===a.minbx)&&(b+=.7),(a.arrowin.bx===a.maxbx||a.arrowout.bx===a.maxbx)&&(b+=.7)):b+=1.4,b},getCanvasRows:function(){var a=this.owner.board,b=this.getBoardRows()+2*this.margin;return pzpr.PLAYER?((a.arrowin.by===a.minby||a.arrowout.by===a.minby)&&(b+=.7),(a.arrowin.by===a.maxby||a.arrowout.by===a.maxby)&&(b+=.7)):b+=1.4,b},getOffsetCols:function(){var a=this.owner.board,b=0;return pzpr.PLAYER&&((a.arrowin.bx===a.minbx||a.arrowout.bx===a.minbx)&&(b+=.35),(a.arrowin.bx===a.maxbx||a.arrowout.bx===a.maxbx)&&(b-=.35)),b},getOffsetRows:function(){var a=this.owner.board,b=0;return pzpr.PLAYER&&((a.arrowin.by===a.minby||a.arrowout.by===a.minby)&&(b+=.35),(a.arrowin.by===a.maxby||a.arrowout.by===a.maxby)&&(b-=.35)),b},drawBorderArrows:function(){for(var a=this.vinc("border_arrow","crispEdges",!0),b=.35*this.cw,c=Math.max(this.cw/36,1),d=c/2,e=this.range.borders,f=0;f<e.length;f++){var g=e[f],h=g.getArrow(),i=g.bx*this.bw,j=g.by*this.bh;if(a.fillStyle=4===g.error?this.errcolor1:this.quescolor,a.vid="b_ar_"+g.id,h!==g.NDIR)switch(h){case g.UP:case g.DN:a.fillRectCenter(i,j,d,b);break;case g.LT:case g.RT:a.fillRectCenter(i,j,b,d)}else a.vhide();if(a.vid="b_tipa_"+g.id,h===g.UP||h===g.LT){switch(a.beginPath(),h){case g.UP:a.setOffsetLinePath(i,j,0,-b,-b/2,.4*-b,b/2,.4*-b,!0);break;case g.LT:a.setOffsetLinePath(i,j,-b,0,.4*-b,-b/2,.4*-b,b/2,!0)}a.fill()}else a.vhide();if(a.vid="b_tipb_"+g.id,h===g.DN||h===g.RT){switch(a.beginPath(),h){case g.DN:a.setOffsetLinePath(i,j,0,+b,-b/2,.4*b,b/2,.4*b,!0);break;case g.RT:a.setOffsetLinePath(i,j,b,0,.4*b,-b/2,.4*b,b/2,!0)}a.fill()}else a.vhide()}},drawInOut:function(){var a,b=this.context,c=this.owner.board;if(b.vid="string_in",a=c.arrowin.getb(),a.id>=c.bdinside&&a.id<c.bdmax){var d=a.bx,e=a.by,f=d*this.bw,g=e*this.bh;e===c.minby?g-=.6*this.ch:e===c.maxby?g+=.6*this.ch:d===c.minbx?(f-=.5*this.cw,g-=.3*this.ch):d===c.maxbx&&(f+=.5*this.cw,g-=.3*this.ch),b.fillStyle=4===a.error?this.errcolor1:this.quescolor,this.disptext("IN",f,g,{ratio:[.55]})}else b.vhide();if(b.vid="string_out",a=c.arrowout.getb(),a.id>=c.bdinside&&a.id<c.bdmax){var d=a.bx,e=a.by,f=d*this.bw,g=e*this.bh;e===c.minby?g-=.6*this.ch:e===c.maxby?g+=.6*this.ch:d===c.minbx?(f-=.7*this.cw,g-=.3*this.ch):d===c.maxbx&&(f+=.7*this.cw,g-=.3*this.ch),b.fillStyle=4===a.error?this.errcolor1:this.quescolor,this.disptext("OUT",f,g,{ratio:[.55]})}else b.vhide()},repaintParts:function(a){this.range.borders=a,this.drawBorderArrows()}},"Encode@icebarn":{decodePzpr:function(a){var b=pzpr.parser,c=a===b.URL_PZPRV3?3:this.checkpflag("c")?2:1;if(2===c){var d=this.outbstr.split("/");this.outbstr=[d[2],d[0],d[1]].join("/")}c>=2?this.decodeIce():this.decodeIce_old1(),3===c?this.decodeBorderArrow():2===c?this.decodeBorderArrow_old2():this.decodeBorderArrow_old1(),this.decodeInOut()},encodePzpr:function(a){var b=pzpr.parser,c=a===b.URL_PZPRV3?3:1;3===c?this.encodeIce():this.encodeIce_old1(),3===c?this.encodeBorderArrow():this.encodeBorderArrow_old1(),this.encodeInOut()},decodeIce_old1:function(){for(var a=this.outbstr,b=this.owner.board,c=0,d=[8,4,2,1],e=0;e<a.length;e++){for(var f=parseInt(a.charAt(e),32),g=0;4>g;g++)c<b.cellmax&&(b.cell[c].ques=f&d[g]?6:0,c++);if(c>=b.cellmax)break}this.outbstr=a.substr(e+1)},encodeIce_old1:function(){for(var a="",b=0,c=0,d=this.owner.board,e=[8,4,2,1],f=0;f<d.cellmax;f++)6===d.cell[f].ques&&(c+=e[b]),b++,4===b&&(a+=c.toString(16),b=0,c=0);b>0&&(a+=c.toString(16)),this.outbstr+=a},decodeBorderArrow:function(){var a=this.outbstr,b=this.owner.board;b.disableInfo();for(var c=0,d=0,e=d;e<a.length;e++){var f=a.charAt(e);if("z"!==f){if(c+=parseInt(f,36),c<b.bdinside){var g=b.border[c];g.setArrow(g.isHorz()?g.UP:g.LT)}c++}else c+=35;if(c>=b.bdinside){d=e+1;break}}c=0;for(var e=d;e<a.length;e++){var f=a.charAt(e);if("z"!==f){if(c+=parseInt(f,36),c<b.bdinside){var g=b.border[c];g.setArrow(g.isHorz()?g.DN:g.RT)}c++}else c+=35;if(c>=b.bdinside){d=e+1;break}}b.enableInfo(),this.outbstr=a.substr(d)},encodeBorderArrow:function(){for(var a="",b=0,c=this.owner.board,d=0;d<c.bdinside;d++){var e=c.border[d],f=e.getArrow();f===e.UP||f===e.LT?(a+=b.toString(36),b=0):(b++,b>=35&&(a+="z",b=0))}b>0&&(a+=b.toString(36)),b=0;for(var d=0;d<c.bdinside;d++){var e=c.border[d],f=e.getArrow();f===e.DN||f===e.RT?(a+=b.toString(36),b=0):(b++,b>=35&&(a+="z",b=0))}b>0&&(a+=b.toString(36)),this.outbstr+=a},decodeBorderArrow_old2:function(){var a=this.outbstr,b=this.owner.board;b.disableInfo();for(var c=0,d=0,e=d;e<a.length;e++){var f=a.charAt(e);if(f>="0"&&"9">=f){var g=parseInt(f,10),h=b.border[c];h.setArrow(1&g?h.RT:h.LT),c+=(g>>1)+1}else if(f>="a"&&"z">=f){var g=parseInt(f,36);c+=g-9}else c++;if(c>=(b.qcols-1)*b.qrows){d=e+1;break}}c=(b.qcols-1)*b.qrows;for(var e=d;e<a.length;e++){var f=a.charAt(e);if(f>="0"&&"9">=f){var g=parseInt(f,10),h=b.border[c];h.setArrow(1&g?h.DN:h.UP),c+=(g>>1)+1}else if(f>="a"&&"z">=f){var g=parseInt(f,36);c+=g-9}else c++;if(c>=b.bdinside){d=e+1;break}}b.enableInfo(),this.outbstr=a.substr(d)},decodeBorderArrow_old1:function(){var a,b=this.outbstr.substr(1).split("/"),c=this.owner.board;if(c.disableInfo(),a=b.shift())for(var d=a.split("+"),e=0;e<d.length;e++){var f=c.cell[d[e]].adjborder.bottom;f.setArrow(f.UP)}if(a=b.shift())for(var d=a.split("+"),e=0;e<d.length;e++){var f=c.cell[d[e]].adjborder.bottom;f.setArrow(f.DN)}if(a=b.shift())for(var d=a.split("+"),e=0;e<d.length;e++){var f=c.cell[d[e]].adjborder.right;f.setArrow(f.LT)}if(a=b.shift())for(var d=a.split("+"),e=0;e<d.length;e++){var f=c.cell[d[e]].adjborder.right;f.setArrow(f.RT)}c.enableInfo(),this.outbstr="/"+b.join("/")},encodeBorderArrow_old1:function(){var a="",b=this.owner.board;a+="/"+b.cell.filter(function(a){var c=a.adjborder.bottom;return c.id<b.bdinside&&c.getArrow()===c.UP}).join("+"),a+="/"+b.cell.filter(function(a){var c=a.adjborder.bottom;return c.id<b.bdinside&&c.getArrow()===c.DN}).join("+"),a+="/"+b.cell.filter(function(a){var c=a.adjborder.right;return c.id<b.bdinside&&c.getArrow()===c.LT}).join("+"),a+="/"+b.cell.filter(function(a){var c=a.adjborder.right;return c.id<b.bdinside&&c.getArrow()===c.RT}).join("+"),this.outbstr+=a}},"Encode@icelom,icelom2":{decodePzpr:function(){this.decodeIce(),this.decodeNumber16(),this.decodeInOut(),"icelom"===this.owner.pid&&(this.owner.pid=this.checkpflag("a")?"icelom":"icelom2")},encodePzpr:function(){this.encodeIce(),this.encodeNumber16(),this.encodeInOut(),"icelom"===this.owner.pid&&(this.outpflag="a")}},Encode:{decodeInOut:function(){var a=this.outbstr.split("/"),b=this.owner.board;b.arrowin.seturlid(+a[1]),b.arrowout.seturlid(+a[2]),this.outbstr=""},encodeInOut:function(){var a=this.owner.board;this.outbstr+="/"+a.arrowin.geturlid()+"/"+a.arrowout.geturlid()}},"FileIO@icebarn":{decodeData:function(){var a=this.owner.board;a.arrowin.setid(+this.readLine()),a.arrowout.setid(+this.readLine()),this.decodeCell(function(a,b){"1"===b&&(a.ques=6)}),this.decodeBorderArrow(),this.decodeBorderLine()},encodeData:function(){var a=this.owner.board;this.datastr+=a.arrowin.getid()+"\n"+a.arrowout.getid()+"\n",this.encodeCell(function(a){return 6===a.ques?"1 ":"0 "}),this.encodeBorderArrow(),this.encodeBorderLine()},decodeBorderArrow:function(){var a=this.owner.board;a.disableInfo(),this.decodeBorder(function(a,b){if("0"!==b){var c=+b,d=a.isVert();1!==c||d||a.setArrow(a.UP),2!==c||d||a.setArrow(a.DN),1===c&&d&&a.setArrow(a.LT),2===c&&d&&a.setArrow(a.RT)}}),a.enableInfo()},encodeBorderArrow:function(){this.encodeBorder(function(a){var b=a.getArrow();return b===a.UP||b===a.LT?"1 ":b===a.DN||b===a.RT?"2 ":"0 "})}},"FileIO@icelom,icelom2":{decodeData:function(){var a=this.owner.board;a.arrowin.setid(+this.readLine()),a.arrowout.setid(+this.readLine());var b=this.readLine();"icelom"===this.owner.pid&&this.owner.changepid("allwhite"===b?"icelom":"icelom2"),this.decodeCell(function(a,b){"i"===b.charAt(0)&&(a.ques=6,b=b.substr(1)),""!==b&&"."!==b&&(a.qnum="?"!==b?+b:-2)}),this.decodeBorderLine()},encodeData:function(){var a=this.owner.board,b="icelom"===this.owner.pid?"allwhite":"skipwhite";this.datastr+=a.arrowin.getid()+"\n"+a.arrowout.getid()+"\n"+b+"\n",this.encodeCell(function(a){var b=6===a.ques?"i":"",c="";return c=-1===a.qnum?""===b?". ":" ":-2===a.qnum?"? ":a.qnum+" ",b+c}),this.encodeBorderLine()}},AnsCheck:{checklist:["checkBranchLine","checkCrossOutOfIce","checkIceLines","checkValidStart","checkLineOnStart","checkDeadendRoad","checkKeepInside","checkFollowArrow@icebarn","checkNumberOrder@!icebarn","checkOneLoop","checkUnreachedUnshadeCell@icelom","checkIgnoreIcebarn@!icelom","checkAllArrow@icebarn","checkNoLineNumber@!icebarn","checkDeadendLine+"],getTraceInfo:function(){return this._info.trace=this._info.trace||this.owner.board.getTraceInfo()},checkCrossOutOfIce:function(){this.checkAllCell(function(a){return 4===a.lcnt&&!a.ice()},"lnCrossExIce")},checkUnreachedUnshadeCell:function(){this.checkAllCell(function(a){return 0===a.ques&&0===a.lcnt},"cuNoLine")},checkIgnoreIcebarn:function(){this.checkLinesInArea(this.owner.board.iceinfo.getAreaInfo(),function(a,b,c){return 0!==c},"bkNoLine")},checkNoLineNumber:function(){this.checkAllCell(function(a){return 0===a.lcnt&&a.isNum()},"nmUnpass")},checkAllArrow:function(){for(var a=this.owner.board,b=0;b<a.bdmax;b++){var c=a.border[b];if(c.isArrow()&&!c.isLine()){if(this.failcode.add("arNoLine"),this.checkOnly)break;c.seterr(4)}}},checkValidStart:function(){var a=this.owner.board,b=a.arrowin.getb();b.by===a.minby&&b.by===a.maxby&&b.bx===a.minbx&&b.bx===a.maxbx&&this.failcode.add("stInvalid")},checkLineOnStart:function(){var a=this.owner.board.arrowin.getb();a.isLine()||(a.seterr(4),this.failcode.add("stNoLine"))},checkDeadendRoad:function(){this.checkTrace(function(a){return a.lastborder.isLine()},"lrDeadEnd")},checkFollowArrow:function(){this.checkTrace(function(a){return a.lastborder.getArrow()===a.dir},"lrReverse")},checkKeepInside:function(){this.checkTrace(function(a){var b=a.lastborder,c=b.owner.board;return b.id<c.bdinside||b.id===c.arrowout.getid()},"lrOffField")},checkNumberOrder:function(){this.checkTrace(function(a){var b=a.lastcell;return b.qnum<0||b.qnum===a.count?!0:(b.seterr(1),!1)},"lrOrder")},checkTrace:function(a,b){var c=this.getTraceInfo();a(c)||(this.failcode.add(b),this.owner.board.border.setnoerr(),c.blist.seterr(1))}},FailCode:{bkNoLine:["すべてのアイスバーンを通っていません。","A icebarn is not gone through."],lnPlLoop:["線がひとつながりではありません。","Lines are not countinuous."],arNoLine:["線が通っていない矢印があります。","A line doesn't go through some arrows."],lrOrder:["数字の通過順が間違っています。","A line goes through an arrow reverse."],nmUnpass:["通過していない数字があります。","The line doesn't pass all of the number."],stInvalid:["スタート位置を特定できませんでした。","System can't detect start position."],stNoLine:["INに線が通っていません。","The line doesn't go through the 'IN' arrow."],lrDeadEnd:["途中で途切れている線があります。","There is a dead-end line."],lrOffField:["盤面の外に出てしまった線があります","A line is not reached out the 'OUT' arrow."],lrReverse:["矢印を逆に通っています。","A line goes through an arrow reverse."],cuNoLine:["通過していない白マスがあります。","The line doesn't pass all of the non-icy cell."]}});