/*! @license pzpr.js v3.5.2-pre (c) 2009-2015 sabo2, MIT license
 *   https://bitbucket.org/sabo2/pzprv3 */
pzpr.classmgr.makeCustom(["bonsan","heyabon","rectslider"],{MouseEvent:{mouseinput:function(){this.owner.playmode?this.mousestart||this.mousemove?this.btn.Left&&this.inputMoveLine():this.mouseend&&this.notInputted()&&this.inputlight():this.owner.editmode&&(this.mousestart||this.mousemove?"heyabon"===this.owner.pid&&this.inputborder():this.mouseend&&this.notInputted()&&this.inputqnum())},inputLine:function(){this.common.inputLine.call(this),!this.owner.execConfig("autocmp")||this.owner.execConfig("dispmove")||this.notInputted()||this.inputautodark()},inputautodark:function(){var a=this.owner.opemgr,b=a.lastope;if("border"===b.group&&"line"===b.property){var c=this.owner.board.getb(b.bx,b.by),d=this.owner.board.linfo,e=new this.owner.CellList;Array.prototype.push.apply(e,c.lineedge),e=e.notnull().filter(function(a){return!!d.id[a.id]}),e.each(function(a){d.getClistByCell(a).each(function(a){a.isNum()&&a.draw()})})}},inputlight:function(){var a=this.getcell();if(!a.isnull){var b=this.owner;"rectslider"!==b.pid&&b.execConfig("autocmp")&&this.inputdark(a)||(0===a.qsub?a.setQsub(this.btn.Left?1:2):1===a.qsub?a.setQsub(this.btn.Left?2:0):2===a.qsub&&a.setQsub(this.btn.Left?0:1),a.draw())}},inputdark:function(a){var b=this.owner.execConfig("dispmove")?a.base:a,c=.6,d=this.inputPoint.bx-a.bx,e=this.inputPoint.by-a.by;return-2===b.qnum&&c*c>d*d+e*e?(b.setQcmp(0===b.qcmp?1:0),b.draw(),!0):!1}},KeyEvent:{enablemake:!0},Cell:{isCmp:function(){var a=this.owner.execConfig("dispmove")?this.base:this;if(1===a.qcmp)return!0;var b=a.getNum(),c=this.owner.board.linfo.getClistByCell(this),d=c.getRectSize();return(1===d.cols||1===d.rows)&&b===c.length-1},maxnum:function(){var a=this.owner.board,b=this.bx,c=this.by,d=(b<a.maxbx>>1?a.maxbx-b:b)>>1,e=(c<a.maxby>>1?a.maxby-c:c)>>1;return Math.max(d,e)},minnum:0},"Cell@heyabon":{distance:null,getState:function(){var a=this.adjacent,b=this.adjborder,c=this.distance-1;return this.isDestination()?8:b.top.isLine()&&a.top.distance===c?0:b.left.isLine()&&a.left.distance===c?1:b.bottom.isLine()&&a.bottom.distance===c?2:b.right.isLine()&&a.right.distance===c?3:-1},setState:function(a){if(0!==a){var b=this.adjborder;0===a?b.top.line=1:1===a?b.left.line=1:2===a?b.bottom.line=1:3===a&&(b.right.line=1)}}},Board:{qcols:8,qrows:8,hasborder:1},"Board@rectslider":{initialize:function(){this.common.initialize.call(this),this.rects=this.addInfoList(this.owner.AreaSlideManager)}},LineManager:{isCenterLine:!0},"AreaRoomManager@bonsan,heyabon":{enabled:!0},AreaLineManager:{enabled:!0,moveline:!0},"AreaLineManager@heyabon":{initMovedBase:function(a){for(var b=0;b<a.length;b++)a[b].distance=null;pzpr.common.AreaLineManager.prototype.initMovedBase.call(this,a)},setMovedBase:function(a){pzpr.common.AreaLineManager.prototype.setMovedBase.call(this,a);var b=this.area[a];if(b.movevalid){var c=b.departure,d=b.departure.qnum;d=d>=0?d:this.owner.board.cellmax,c.distance=d;for(var e=+{1:1,2:2,4:3,8:4}[15&this.linkinfo[c.id]],f=c.getaddr(),g=c.distance;;){f.movedir(e,2);var c=f.getc(),h=c.adjborder;if(c.isnull||c.lcnt>=3||0===c.lcnt)break;if(c.distance=--g,c===b.destination)break;1!==e&&h.bottom.isLine()?e=2:2!==e&&h.top.isLine()?e=1:3!==e&&h.right.isLine()?e=4:4!==e&&h.left.isLine()&&(e=3)}}}},"AreaSlideManager:AreaShadeManager@rectslider":{enabled:!0,relation:["cell","line"],isvalid:function(a){return-1!==a.base.qnum},bdfunc:function(){return!1},setLine:function(a){if(this.enabled){var b=a.sidecell[0],c=a.sidecell[1],d=this.owner.board.linfo,e=new this.owner.CellList,f=this,g=d.id[b.id],h=d.id[c.id];g===h&&null!==g?e.extend(d.getClistByCell(b)):(null!==g?e.extend(d.area[g].clist):e.add(b),null!==h?e.extend(d.area[h].clist):e.add(c)),e=e.filter(function(a){return-1!==a.base.qnum||null!==f.id[a.id]});for(var i=[],j=0;j<e.length;j++)this.calcLinkInfo(e[j]),i.push(e[j].id),i=i.concat(this.getLinkCell(e[j]));this.remakeInfo(i)}}},Flags:{autocmp:"number"},Graphic:{hideHatena:!0,gridcolor_type:"LIGHT",bgcellcolor_func:"qsub2",qsubcolor1:"rgb(224, 224, 255)",qsubcolor2:"rgb(255, 255, 144)",circlefillcolor_func:"qcmp",globalfontsizeratio:.9,paint:function(){this.drawBGCells(),this.drawGrid(),"heyabon"===this.owner.pid&&this.drawBorders(),this.drawTip(),this.drawDepartures(),this.drawLines(),this.drawCircles(),this.drawNumbers(),this.drawChassis(),this.drawTarget()}},"Graphic@rectslider":{globalfontsizeratio:1,fontShadecolor:"white",qcmpcolor:"gray",mbcolor:"green",paint:function(){this.drawDashedGrid(),this.drawTip(),this.drawDepartures(),this.drawLines(),this.drawShadedCells(),this.drawMBs(),this.drawNumbers(),this.drawChassis(),this.drawTarget()},getCellColor:function(a){var b=this.owner;if(-1===(b.execConfig("dispmove")?a.base:a).qnum)return null;if(b.execConfig("dispmove")&&b.mouse.mouseCell===a)return this.movecolor;var c=a.error||a.qinfo;return 0===c?this.quescolor:1===c?this.errcolor1:null},getCellNumberColor:function(a){return this.owner.execConfig("autocmp")&&a.isCmp()?this.qcmpcolor:this.fontShadecolor}},Encode:{decodePzpr:function(){this.checkpflag("c")||this.decodeBorder(),this.decodeNumber16(),this.checkPuzzleid()},encodePzpr:function(a){1===a||"heyabon"===this.owner.pid?this.encodeBorder():this.outpflag="c",this.encodeNumber16()},checkPuzzleid:function(){var a=this.owner,b=a.board;if("bonsan"===a.pid)for(var c=0;c<b.bdmax;c++)if(1===b.border[c].ques){a.changepid("heyabon");break}},decodeKanpen:function(){this.owner.fio.decodeAreaRoom(),this.owner.fio.decodeQnum_PBox_Sato()},encodeKanpen:function(){this.owner.fio.encodeAreaRoom(),this.owner.fio.encodeQnum_PBox_Sato()}},"Encode@rectslider":{decodePzpr:function(){this.decodeNumber16()},encodePzpr:function(){this.encodeNumber16()}},FileIO:{decodeData:function(){this.decodeCellQnum(),this.decodeCellQsubQcmp(),"rectslider"!==this.owner.pid&&this.decodeBorderQues(),this.decodeBorderLine(),this.owner.enc.checkPuzzleid()},encodeData:function(){this.encodeCellQnum(),this.encodeCellQsubQcmp(),"rectslider"!==this.owner.pid&&this.encodeBorderQues(),this.encodeBorderLine()},decodeCellQsubQcmp:function(){this.decodeCell(function(a,b){if("0"!==b){var c=parseInt(b);a.qsub=15&c,a.qcmp=c>>4|0}})},encodeCellQsubQcmp:function(){this.encodeCell(function(a){var b=a.qsub+(a.qcmp<<4);return b.toString()+" "})},kanpenOpen:function(){this.decodeAreaRoom(),this.decodeQnum_PBox_Sato(),this.decodeLine_PBox_Sato()},kanpenSave:function(){this.encodeAreaRoom(),this.encodeQnum_PBox_Sato(),this.encodeLine_PBox_Sato()},decodeQnum_PBox_Sato:function(){this.decodeCell(function(a,b){"-"===b?a.qnum=-2:"."!==b&&(a.qnum=parseInt(b))})},encodeQnum_PBox_Sato:function(){this.encodeCell(function(a){return a.qnum>=0?a.qnum.toString()+" ":-2===a.qnum?"- ":". "})},decodeLine_PBox_Sato:function(){this.decodeCell(function(a,b){a.setState(+b)})},encodeLine_PBox_Sato:function(){this.encodeCell(function(a){var b=a.getState();return b>=0?""+b+" ":". "})},kanpenOpenXML:function(){this.decodeAreaRoom_XMLBoard(),this.decodeCellQnum_XMLBoard(),this.decodeBorderLine_satogaeri_XMLAnswer()},kanpenSaveXML:function(){this.encodeAreaRoom_XMLBoard(),this.encodeCellQnum_XMLBoard(),this.encodeBorderLine_satogaeri_XMLAnswer()},UNDECIDED_NUM_XML:-2,decodeBorderLine_satogaeri_XMLAnswer:function(){this.decodeCellXMLArow(function(a,b){a.setState(+b.substr(1))})},encodeBorderLine_satogaeri_XMLAnswer:function(){this.encodeCellXMLArow(function(a){return"n"+a.getState()})}},AnsCheck:{checklist:["checkBranchLine","checkCrossLine","checkConnectObject","checkLineOverLetter","checkCurveLine","checkMovedBlockRect@rectslider","checkMovedBlockSize@rectslider","checkLineLength","checkFractal@!rectslider","checkNoObjectBlock@heyabon","checkNoMoveCircle","checkDisconnectLine"],checkCurveLine:function(){this.checkAllArea(this.getLareaInfo(),function(a,b){return 1===a||1===b},"laCurve")},checkLineLength:function(){this.checkAllArea(this.getLareaInfo(),function(a,b,c,d){return 0>d||1===c||d===c-1},"laLenNe")},checkNoMoveCircle:function(){this.checkAllCell(function(a){return a.qnum>=1&&0===a.lcnt},"nmNoMove")},checkFractal:function(){var a=this.getRoomInfo();a:for(var b=1;b<=a.max;b++){var c=a.area[b].clist,d=c.getRectSize();d.xx=d.x1+d.x2,d.yy=d.y1+d.y2;for(var e=0;e<c.length;e++){var f=c[e];if(f.isDestination()!==this.owner.board.getc(d.xx-f.bx,d.yy-f.by).isDestination()){if(this.failcode.add("bonsan"===this.owner.pid?"brObjNotSym":"bkObjNotSym"),this.checkOnly)break a;c.filter(function(a){return a.isDestination()}).seterr(1)}}}},checkNoObjectBlock:function(){this.checkNoMovedObjectInRoom(this.getRoomInfo())}},"AnsCheck@rectslider":{getRectInfo:function(){return this._info.rect=this._info.rect||this.owner.board.rects.getAreaInfo()},checkMovedBlockRect:function(){this.checkAllArea(this.getRectInfo(),function(a,b,c){return a*b===c},"csNotRect")},checkMovedBlockSize:function(){this.checkAllArea(this.getRectInfo(),function(a,b,c){return c>1},"bkSize1")}},FailCode:{bkNoNum:["○のない部屋があります。","A room has no circle."],bkObjNotSym:["部屋の中の○が点対称に配置されていません。","Position of circles in the room is not point symmetric."],brObjNotSym:["○が点対称に配置されていません。","Position of circles is not point symmetric."],laOnNum:["○の上を線が通過しています。","A line goes through a circle."],laIsolate:["○につながっていない線があります。","A line doesn't connect any circle."],nmConnected:["○が繋がっています。","There are connected circles."],nmNoMove:["○から線が出ていません。","A circle doesn't start any line."]},"FailCode@rectslider":{csNotRect:["黒マスのカタマリが正方形か長方形ではありません。","A mass of shaded cells is not rectangle."],bkSize1:["黒マスが一つで孤立しています。","There is a isolated shaded cells."],laOnNum:["黒マスの上を線が通過しています。","A line goes through a shaded cell."],laIsolate:["黒マスにつながっていない線があります。","A line doesn't connect any shaded cell."],nmConnected:["黒マスが繋がっています。","There are connected shaded cells."],nmNoMove:["黒マスから線が出ていません。","A shaded cell doesn't start any line."]}});