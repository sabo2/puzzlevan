/*! @license pzpr.js v3.5.2-pre (c) 2009-2015 sabo2, MIT license
 *   https://bitbucket.org/sabo2/pzprv3 */
pzpr.classmgr.makeCustom(["kakuro"],{MouseEvent:{mouseinput:function(){this.owner.playmode?this.mousestart&&this.inputqnum():this.owner.editmode&&this.mousestart&&this.input51()}},KeyEvent:{enablemake:!0,enableplay:!0,keyinput:function(a){this.owner.editmode?this.inputnumber51(a,{2:45,4:45}):this.owner.playmode&&this.key_inputqnum(a)}},TargetCursor:{adjust_modechange:function(){this.owner.playmode&&(this.bx<1&&(this.bx=1),this.by<1&&(this.by=1))}},Cell:{qnum:0,qnum2:0,noNum:function(){return!this.isnull&&0===this.qnum&&0===this.qnum2&&-1===this.anum},disInputHatena:!0,maxnum:9,getNum:function(){return this.anum},setNum:function(a){this.setAnum(a>0?a:-1)},prehook:{qnum:function(){return!1},qnum2:function(){return!1}}},EXCell:{ques:51,qnum:0,qnum2:0},Board:{qcols:11,qrows:11,hasborder:1,hasexcell:1},BoardExec:{adjustBoardData:function(a,b){this.adjustQues51_1(a,b)},adjustBoardData2:function(a,b){this.adjustQues51_2(a,b)}},Graphic:{ttcolor:"rgb(255,255,127)",paint:function(){this.drawBGCells(),this.drawBGEXcells(),this.drawQues51(),this.drawGrid(),this.drawBorders(),this.drawChassis_ex1(!1),this.drawNumbersOn51(),this.drawNumbers_kakuro(),this.drawCursor()},getBGCellColor:function(a){return 1===a.error?this.errbcolor1:51===a.ques?"rgb(192,192,192)":null},getBGEXcellColor:function(a){return a.error?this.errbcolor1:"rgb(192,192,192)"},getBorderColor:function(a){var b=a.sidecell[0],c=a.sidecell[1];return!b.isnull&&!c.isnull&&51===b.ques^51===c.ques?this.quescolor:null},drawNumbers_kakuro:function(){for(var a=this.vinc("cell_number","auto"),b=this.range.cells,c=0;c<b.length;c++){var d=b[c],e=d.bx*this.bw,f=d.by*this.bh;a.vid="cell_text_anum"+d.id,!d.is51cell()&&d.anum>0?(a.fillStyle=1===d.error?this.fontErrcolor:this.fontAnscolor,this.disptext(""+d.anum,e,f)):a.vhide()}}},Encode:{decodePzpr:function(){this.decodeKakuro()},encodePzpr:function(){this.encodeKakuro()},decodeKanpen:function(){this.owner.fio.decodeCellQnum51_kanpen()},encodeKanpen:function(){this.owner.fio.encodeCellQnum51_kanpen()},decodeKakuro:function(){for(var a=0,b=0,c=this.outbstr,d=this.owner.board,e=0;e<c.length;e++){var f=c.charAt(e),g=d.cell[a];if(f>="k"&&"z">=f?a+=parseInt(f,36)-19:(g.ques=51,"."!==f&&(g.qnum2=this.decval(f),g.qnum=this.decval(c.charAt(e+1)),e++),a++),a>=d.cellmax){b=e+1;break}}for(var e=b,h=1;h<d.maxbx;h+=2)d.getc(h,1).is51cell()||(d.getex(h,-1).qnum2=this.decval(c.charAt(e)),e++);for(var i=1;i<d.maxby;i+=2)d.getc(1,i).is51cell()||(d.getex(-1,i).qnum=this.decval(c.charAt(e)),e++);this.outbstr=c.substr(b)},encodeKakuro:function(){for(var a="",b=this.owner.board,c=0,d=0;d<b.cellmax;d++){var e="",f=b.cell[d];51===f.ques?e=f.qnum<=0&&f.qnum2<=0?".":""+this.encval(f.qnum2)+this.encval(f.qnum):c++,0===c?a+=e:(e||16===c)&&(a+=(c+19).toString(36)+e,c=0)}c>0&&(a+=(c+19).toString(36));for(var g=1;g<b.maxbx;g+=2)b.getc(g,1).is51cell()||(a+=this.encval(b.getex(g,-1).qnum2));for(var h=1;h<b.maxby;h+=2)b.getc(1,h).is51cell()||(a+=this.encval(b.getex(-1,h).qnum));this.outbstr+=a},decval:function(a){return a>="0"&&"9">=a?parseInt(a,36):a>="a"&&"j">=a?parseInt(a,36):a>="A"&&"Z">=a?parseInt(a,36)+10:""},encval:function(a){return a>=1&&19>=a?a.toString(36).toLowerCase():a>=20&&45>=a?(a-10).toString(36).toUpperCase():"0"}},FileIO:{decodeData:function(){this.decodeCellQnum51(),this.decodeCellAnumsub()},encodeData:function(){this.encodeCellQnum51(),this.encodeCellAnumsub()},kanpenOpen:function(){this.decodeCellQnum51_kanpen(),this.decodeQans_kanpen()},kanpenSave:function(){this.encodeCellQnum51_kanpen(),this.datastr+="\n",this.encodeQans_kanpen()},decodeCellQnum51_kanpen:function(){for(var a=this.owner.board;;){var b=this.readLine();if(!b)break;var c=b.split(" ");if(c.length<=1)return;if("0"===c[0]&&"0"===c[1]);else if("0"===c[0]||"0"===c[1]){var d=a.getex(2*parseInt(c[1])-1,2*parseInt(c[0])-1);"0"===c[0]?d.qnum2=parseInt(c[3]):"0"===c[1]&&(d.qnum=parseInt(c[2]))}else{var e=a.getc(2*parseInt(c[1])-1,2*parseInt(c[0])-1);e.ques=51,e.qnum2=parseInt(c[3]),e.qnum=parseInt(c[2])}}},encodeCellQnum51_kanpen:function(){for(var a=this.owner.board,b=a.minby+1;b<a.maxby;b+=2)for(var c=a.minbx+1;c<a.maxbx;c+=2){var d=[(b+1>>1).toString(),(c+1>>1).toString(),0,0];if(-1===c&&-1===b);else if(-1===c||-1===b){var e=a.getex(c,b);-1===c&&(d[2]=e.qnum.toString()),-1===b&&(d[3]=e.qnum2.toString())}else{var f=a.getc(c,b);if(51!==f.ques)continue;d[2]=f.qnum.toString(),d[3]=f.qnum2.toString()}this.datastr+=d.join(" ")+"\n"}},decodeQans_kanpen:function(){for(var a=this.owner.board,b=this.readLines(a.qrows+1),c=a.minby+1;c<a.maxby&&!(c+1>>1>=b.length);c+=2)for(var d=b[c+1>>1].split(" "),e=a.minbx+1;e<a.maxbx;e+=2)if(""!==d[e+1>>1]){var f=a.getc(e,c);f.isnull||"."===d[e+1>>1]||"0"===d[e+1>>1]||(f.anum=parseInt(d[e+1>>1]))}},encodeQans_kanpen:function(){for(var a=this.owner.board,b=a.minby+1;b<a.maxby;b+=2){for(var c=a.minbx+1;c<a.maxbx;c+=2){var d=a.getc(c,b);this.datastr+=d.isnull?". ":51===d.ques?". ":d.anum>0?d.anum.toString()+" ":"0 "}b<a.maxby-1&&(this.datastr+="\n")}},kanpenOpenXML:function(){this.decodeCellQnum51_XMLBoard(),this.decodeCellAnum_kakuro_XMLAnswer()},kanpenSaveXML:function(){this.encodeCellQnum51_XMLBoard(),this.encodeCellAnum_kakuro_XMLAnswer()},decodeCellQnum51_XMLBoard:function(){for(var a=this.xmldoc.querySelectorAll("board wall"),b=this.owner.board,c=0;c<a.length;c++){var d=a[c],e=2*+d.getAttribute("c")-3,f=2*+d.getAttribute("r")-3,g=+d.getAttribute("a"),h=+d.getAttribute("b"),i=b.getobj(e,f);i.ques=51,g>0&&(i.qnum=g),h>0&&(i.qnum2=h)}},encodeCellQnum51_XMLBoard:function(){for(var a=this.xmldoc.querySelector("board"),b=this.owner.board,c=-1;c<b.maxby;c+=2)for(var d=-1;d<b.maxbx;d+=2){var e=b.getobj(d,c);if(51===e.ques){var f=e.qnum>0?e.qnum:0,g=e.qnum2>0?e.qnum2:0;a.appendChild(this.createXMLNode("wall",{r:c+3>>1,c:d+3>>1,a:f,b:g}))}}},PBOX_ADJUST:2,decodeCellAnum_kakuro_XMLAnswer:function(){this.decodeCellXMLArow(function(a,b){"n-1"!==b&&"n0"!==b&&51!==a.ques&&(a.anum=+b.substr(1))})},encodeCellAnum_kakuro_XMLAnswer:function(){this.encodeCellXMLArow(function(a){return 0===a.ques&&-1===a.anum?"n0":"n"+a.anum})}},AnsCheck:{checklist:["checkSameNumberInLine","checkSumOfNumberInLine","checkNoNumCell+"],checkSameNumberInLine:function(){this.checkRowsColsPartly(this.isSameNumber,function(a){return a.is51cell()},"nmDupRow")},isSameNumber:function(a,b){var c=this.isDifferentAnsNumberInClist(a);return c||b.keycell.seterr(1),c},checkSumOfNumberInLine:function(){this.checkRowsColsPartly(this.isTotalNumber,function(a){return a.is51cell()},"nmSumRowNe")},isTotalNumber:function(a,b){for(var c=b.key51num,d=0,e=0;e<a.length;e++){if(!(a[e].anum>0))return!0;d+=a[e].anum}var f=0>=c||d===c;return f||(b.keycell.seterr(1),a.seterr(1)),f}},FailCode:{nmSumRowNe:["数字の下か右にある数字の合計が間違っています。","The sum of the cells is not correct."],ceNoNum:["すべてのマスに数字が入っていません。","There is an empty cell."]}});