/*! @license pzpr.js v3.5.2-pre (c) 2009-2015 sabo2, MIT license
 *   https://bitbucket.org/sabo2/pzprv3 */
pzpr.classmgr.makeCustom(["gokigen","wagiri"],{MouseEvent:{mouseinput:function(){var a=this.owner;a.playmode&&this.mousestart?this.inputslash():a.editmode&&this.mousestart&&("gokigen"===a.pid?this.inputcross():"wagiri"===a.pid&&this.inputquestion())},inputslash:function(){var a=this.getcell();if(!a.isnull){var b=this.owner.getConfig("use"),c=this.btn.Left?31:32,d=a.qans;1===b?a.setQans(d!==c?c:0):2===b&&a.setQans((this.btn.Left?{0:31,31:32,32:0}:{0:32,31:0,32:31})[d]),a.drawaround()}}},"MouseEvent@gokigen":{dispRed:function(){var a=this.owner,b=a.playmode&&a.key.isZ;return b&&this.dispBlue(),b},dispBlue:function(){var a=this.getcell();if(this.mousereset(),!a.isnull&&0!==a.qans){for(var b=a.relcross(31===a.qans?-1:1,-1),c=this.owner.board,d=c.searchline(b),e=0;e<c.cellmax;e++){var f=c.cell[e];31===f.qans&&1===d[f.relcross(-1,-1).id]&&f.seterr(2),32===f.qans&&1===d[f.relcross(1,-1).id]&&f.seterr(2)}c.haserror=!0,this.owner.redraw()}}},"MouseEvent@wagiri":{inputquestion:function(){var a=this.getpos(.33);a.isinside()&&(this.cursor.equals(a)?a.oncross()?this.inputcross():a.oncell()&&this.inputwagiri(a):this.setcursor(a))},inputwagiri:function(a){var b=a.getc();if(!b.isnull){var c=this.btn.Left?[-1,1,0,2,-2]:[2,-2,0,-1,1];b.setNum(c[b.qnum+2]),b.draw()}}},"KeyEvent@gokigen":{enablemake:!0,moveTarget:function(a){return this.moveTCross(a)},keyinput:function(a){this.key_inputcross(a)}},"KeyEvent@wagiri":{enablemake:!0,moveTarget:function(a){return this.moveTBorder(a)},keyinput:function(a){this.key_wagiri(a)},key_wagiri:function(a){var b=this.cursor;if(b.oncross())this.key_inputcross(a);else if(b.oncell()){var c=b.getc(),d=0;"1"===a?d=1:"2"===a?d=2:"-"===a?d=-2:" "===a&&(d=-1),c.isnull||0===d||(c.setNum(d),c.draw())}}},TargetCursor:{crosstype:!0},Cross:{maxnum:4,minnum:0},Board:{qcols:7,qrows:7,getSlashData:function(){for(var a=[],b=this.getSlashInfo(),c=0;c<this.cellmax;c++)a[c]=0!==this.cell[c].qans?0:-1;for(var c=0;c<this.cellmax;c++)if(0===a[c]){var d=this.cell[c],e=d.relcross(31===d.qans?-1:1,-1);this.searchloop(e.id,b,a)}for(var c=0;c<this.cellmax;c++)0===a[c]&&(a[c]=2);return a},searchloop:function(a,b,c){for(var d=[],e=0;e<this.crossmax;e++)d[e]=!1;for(var e=a,f=[{cell:null,cross:a}];f.length>0;){var g=null,e=f[f.length-1].cross;d[e]=!0;for(var h=0;h<b.cross[e].length;h++){var i=b.cross[e][h];if(b.cell[i].length){g=i;break}}if(null!==g){var j=b.cell[g][b.cell[g][0]!==e?0:1];if(f.push({cell:g,cross:null}),b.cell[g]=[],!d[j]){f[f.length-1].cross=j;continue}for(var h=f.length-1;h>=0&&f[h].cross!==j;h--)c[f[h].cell]=1}else b.cross[e]=[];var k=f.pop();0===c[k.cell]&&(c[k.cell]=2)}},getSlashInfo:function(){for(var a={cell:[],cross:[]},b=0;b<this.crossmax;b++)a.cross[b]=[];for(var b=0;b<this.cellmax;b++){a.cell[b]=[];var c,d,e=this.cell[b];if(31===e.qans)c=e.relcross(-1,-1),d=e.relcross(1,1);else{if(32!==e.qans)continue;c=e.relcross(-1,1),d=e.relcross(1,-1)}a.cell[b]=[c.id,d.id],a.cross[c.id].push(b),a.cross[d.id].push(b)}return a},searchline:function(a){for(var b=[],c=[a],d=0;d<this.crossmax;d++)b[d]=0;for(;c.length>0;){var e=c.pop();if(0===b[e.id]){b[e.id]=1;var f;f=e.relcross(-2,-2),f.isnull||0!==b[f.id]||31!==e.relcell(-1,-1).qans||c.push(f),f=e.relcross(2,-2),f.isnull||0!==b[f.id]||32!==e.relcell(1,-1).qans||c.push(f),f=e.relcross(-2,2),f.isnull||0!==b[f.id]||32!==e.relcell(-1,1).qans||c.push(f),f=e.relcross(2,2),f.isnull||0!==b[f.id]||31!==e.relcell(1,1).qans||c.push(f)}}return b}},BoardExec:{adjustBoardData:function(a){if(a&this.TURNFLIP)for(var b=this.owner.board.cell,c=0;c<b.length;c++){var d=b[c];d.setQans({0:0,31:32,32:31}[d.qans])}}},Flags:{use:!0,disable_subclear:!0},Graphic:{margin:.5,gridcolor_type:"DLIGHT",errcolor1:"red",errcolor2:"rgb(32, 32, 255)",crosssize:.33,paintRange:function(a,b,c,d){var e=this.owner.board;!e.haserror&&this.owner.getConfig("autoerr")?this.setRange(e.minbx-2,e.minby-2,e.maxbx+2,e.maxby+2):this.setRange(a,b,c,d),this.prepaint()},paint:function(){this.drawBGCells(),this.drawDashedGrid(!1),"wagiri"===this.owner.pid&&this.drawNumbers(),this.drawSlashes(),this.drawCrosses(),this.drawTarget()},getBGCellColor:function(a){return 0===a.qans&&1===a.error?this.errbcolor1:null},drawSlashes:function(){var a=this.owner,b=a.board;if(!b.haserror&&a.getConfig("autoerr")){var c=b.getSlashData();"gokigen"===a.pid?b.cell.each(function(a){a.qinfo=1===c[a.id]?1:0}):"wagiri"===a.pid&&b.cell.each(function(a){a.qinfo=c[a.id]}),this.common.drawSlashes.call(this),b.cell.setinfo(0)}else this.common.drawSlashes.call(this)}},"Graphic@wagiri":{errcolor2:"rgb(0, 0, 127)",drawNumber1:function(a){var b=this.context,c={"-2":"?",1:"輪",2:"切"}[a.qnum]||"";b.vid="cell_text_"+a.id,c?(b.fillStyle=this.fontcolor,this.disptext(c,a.bx*this.bw,a.by*this.bh,{ratio:[.7]})):b.vhide()},drawTarget:function(){var a=!this.owner.cursor.onborder();this.drawCursor(a,this.owner.editmode)}},"Encode@gokigen":{decodePzpr:function(a){var b=pzpr.parser,c=a===b.URL_PZPRAPP&&!this.checkpflag("c")||a===b.URL_PZPRV3&&this.checkpflag("d");c?this.decodecross_old():this.decode4Cross()},encodePzpr:function(a){a===pzpr.parser.URL_PZPRAPP&&(this.outpflag="c"),this.encode4Cross()}},"Encode@wagiri":{decodePzpr:function(){this.decode4Cross(),this.decodeNumber10()},encodePzpr:function(){this.encode4Cross(),this.encodeNumber10()}},FileIO:{decodeData:function(){this.decodeCrossNum(),"wagiri"===this.owner.pid&&this.decodeCellQnum(),this.decodeCell(function(a,b){"1"===b?a.qans=31:"2"===b&&(a.qans=32)})},encodeData:function(){this.encodeCrossNum(),"wagiri"===this.owner.pid&&this.encodeCellQnum(),this.encodeCell(function(a){return 31===a.qans?"1 ":32===a.qans?"2 ":". "})}},AnsCheck:{checklist:["checkSlashLoop","checkQnumCross","checkSlashNoLoop@wagiri","checkNoSlashCell+"],getSlashInfo:function(){return this._info.slash=this._info.slash||this.owner.board.getSlashData()},checkQnumCross:function(){for(var a=this.owner.board,b=a.getSlashInfo(),c=0;c<a.crossmax;c++){var d=a.cross[c],e=d.qnum;if(!(0>e||e===b.cross[c].length)){if(this.failcode.add("crConnSlNe"),this.checkOnly)break;d.seterr(1)}}},checkNoSlashCell:function(){this.checkAllCell(function(a){return 0===a.qans},"ceNoSlash")}},"AnsCheck@gokigen":{checkSlashLoop:function(){var a=this.getSlashInfo(),b=this.owner.board.cell.filter(function(b){return 1===a[b.id]});b.length>0&&(this.failcode.add("slLoop"),b.seterr(1))}},"AnsCheck@wagiri":{checkSlashLoop:function(){this.checkLoops_wagiri(!1,"slLoopGiri")},checkSlashNoLoop:function(){this.checkLoops_wagiri(!0,"slNotLoopWa")},checkLoops_wagiri:function(a,b){for(var c=!0,d=this.owner.board,e=this.getSlashInfo(),f=0;f<d.cellmax;f++)a||1!==e[f]||2!==d.cell[f].qnum||(c=!1),a&&2===e[f]&&1===d.cell[f].qnum&&(c=!1);if(!c){this.failcode.add(b);for(var f=0;f<d.cellmax;f++)e[f]>0&&d.cell[f].seterr(e[f])}}},FailCode:{slLoop:["斜線で輪っかができています。","There is a loop consisted in some slashes."],slLoopGiri:["'切'が含まれた線が輪っかになっています。","There is a loop that consists '切'."],slNotLoopWa:["'輪'が含まれた線が輪っかになっていません。","There is not a loop that consists '輪'."],crConnSlNe:["数字に繋がる線の数が間違っています。","A number is not equal to count of lines that is connected to it."],ceNoSlash:["斜線がないマスがあります。","There is an empty cell."]}});