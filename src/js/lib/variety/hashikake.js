/*! @license pzpr.js v3.5.2 (c) 2009-2015 sabo2, MIT license
 *   https://bitbucket.org/sabo2/pzprv3 */
pzpr.classmgr.makeCustom(["hashikake"],{MouseEvent:{mouseinput:function(){this.owner.playmode?this.btn.Left?this.mousestart||this.mousemove?this.inputLine():this.mouseend&&this.notInputted()&&this.inputpeke():this.btn.Right&&(this.mousestart||this.mousemove)&&this.inputpeke():this.owner.editmode&&this.mousestart&&this.inputqnum()},prevblist:null,mousereset:function(){this.common.mousereset.call(this),this.prevblist=new this.owner.BorderList},inputLine:function(){var a=this.getpos(.2);if(!this.prevPos.equals(a)){var b=this.getlineobj(this.prevPos,a);if(!b.isnull){var c=this.getlinedir(this.prevPos,a),d=b.getlinesize(),e=this.owner.board.borderinside(d.x1,d.y1,d.x2,d.y2);0!==this.prevblist.length&&this.prevblist.include(b)||(this.inputData=null),null===this.inputData&&(this.inputData=[1,2,0][b.line]),this.inputData>0&&(c===b.UP||c===b.LT)&&e.reverse(),e.setLineVal(this.inputData),e.setQsub(0),this.prevblist=e,this.owner.painter.paintRange(d.x1-1,d.y1-1,d.x2+1,d.y2+1)}this.prevPos=a}},getlineobj:function(a,b){return 1===(1&b.bx)&&a.bx===b.bx&&1===Math.abs(a.by-b.by)||1===(1&b.by)&&a.by===b.by&&1===Math.abs(a.bx-b.bx)?(a.onborder()?a:b).getb():this.owner.board.nullobj},getlinedir:function(a,b){var c=b.bx-a.bx,d=b.by-a.by;return 0===c&&-1===d?a.UP:0===c&&1===d?a.DN:-1===c&&0===d?a.LT:1===c&&0===d?a.RT:a.NDIR},inputpeke:function(){var a=this.getpos(.22);if(!this.btn.Right||!this.prevPos.equals(a)){var b=a.getb();if(!b.isnull){null===this.inputData&&(this.inputData=2!==b.qsub?2:0),b.setQsub(this.inputData);var c=b.getlinesize();this.owner.board.borderinside(c.x1,c.y1,c.x2,c.y2).setLineVal(0),this.prevPos=a,this.owner.painter.paintRange(c.x1-1,c.y1-1,c.x2+1,c.y2+1),b.draw()}}}},KeyEvent:{enablemake:!0},Cell:{maxnum:8,getCountOfBridges:function(){for(var a=0,b=this.getdir4cblist(),c=0;c<b.length;c++){var d=b[c][1];!d.isnull&&d.line>0&&(a+=d.line)}return a},isCmp:function(){return this.qnum===this.getCountOfBridges()},iscrossing:function(){return this.noNum()},getState:function(){if(-1!==this.qnum)return 0;var a=this.adjborder.top,b=this.adjborder.left,c=a.isnull?0:a.line,d=b.isnull?0:b.line;return(c>0?c:0)+(d>0?d<<2:0)},setState:function(a){if(0!==a){var b=this.adjborder,c=3&a;if(c>0){var d=b.top,e=b.bottom;d.isnull||(d.line=c),e.isnull||(e.line=c)}var f=(12&a)>>2;if(f>0){var g=b.left,h=b.right;g.isnull||(g.line=f),h.isnull||(h.line=f)}}}},Border:{getlinesize:function(){var a=this.getaddr(),b=a.clone();if(this.isVert()){for(;a.move(-1,0).getc().noNum();)a.move(-1,0);for(;b.move(1,0).getc().noNum();)b.move(1,0)}else{for(;a.move(0,-1).getc().noNum();)a.move(0,-1);for(;b.move(0,1).getc().noNum();)b.move(0,1)}return a.getc().isnull||b.getc().isnull?{x1:-1,y1:-1,x2:-1,y2:-1}:{x1:a.bx,y1:a.by,x2:b.bx,y2:b.by}}},BorderList:{setLineVal:function(a){this.each(function(b){b.setLineVal(a)})},setQsub:function(a){this.each(function(b){b.setQsub(a)})}},Board:{qcols:9,qrows:9,hasborder:1},LineManager:{isCenterLine:!0,isLineCross:!0},AreaLineManager:{enabled:!0},Flags:{autocmp:"number",irowake:!0},Graphic:{hideHatena:!0,gridcolor_type:"THIN",globalfontsizeratio:.85,circleratio:[.47,.42],circlefillcolor_func:"qcmp",lwratio:8,paint:function(){this.drawGrid(!1,this.owner.editmode&&!this.outputImage),this.drawPekes(),this.drawLines_hashikake(),this.drawCircles(),this.drawNumbers(),this.drawTarget()},drawLines_hashikake:function(){for(var a=this.vinc("line","crispEdges",!0),b=this.lw+this.addlw,c=this.lm,d=1.5*b,e=this.range.borders,f=0;f<e.length;f++){var g=e[f],h=this.getLineColor(g),i=g.isVert(),j=g.bx*this.bw,k=g.by*this.bh;a.fillStyle=h,a.vid="b_line_"+g.id,h&&1===g.line?i?a.fillRectCenter(j,k,this.bw+c,c):a.fillRectCenter(j,k,c,this.bh+c):a.vhide(),a.vid="b_dline_"+g.id,h&&2===g.line?(a.beginPath(),i?(a.rectcenter(j,k-d,this.bw+c,c),a.rectcenter(j,k+d,this.bw+c,c)):(a.rectcenter(j-d,k,c,this.bh+c),a.rectcenter(j+d,k,c,this.bh+c)),a.fill()):a.vhide()}},repaintLines:function(a){this.range.borders=a,this.drawLines_hashikake(),this.context.use.canvas&&this.repaintParts(a)},repaintParts:function(a){this.range.cells=a.cellinside(),this.drawCircles(),this.drawNumbers()}},Encode:{decodePzpr:function(){this.decodeNumber16()},encodePzpr:function(){this.encodeNumber16()},decodeKanpen:function(){this.owner.fio.decodeCellQnum_kanpen()},encodeKanpen:function(){this.owner.fio.encodeCellQnum_kanpen()}},FileIO:{decodeData:function(){this.decodeCellQnum(),this.decodeBorderLine()},encodeData:function(){this.encodeCellQnum(),this.encodeBorderLine()},kanpenOpen:function(){this.decodeCell(function(a,b){b>="1"&&"8">=b?a.qnum=+b:"9"===b&&(a.qnum=-2)}),this.decodeCell(function(a,b){"0"!==b&&a.setState(+b)})},kanpenSave:function(){this.encodeCell(function(a){return a.qnum>0?a.qnum+" ":-2===a.qnum?"9 ":". "}),this.encodeCell(function(a){return""+a.getState()+" "})},kanpenOpenXML:function(){this.decodeCellQnum_XMLBoard(),this.decodeBorderLine_hashikake_XMLAnswer()},kanpenSaveXML:function(){this.encodeCellQnum_XMLBoard(),this.encodeBorderLine_hashikake_XMLAnswer()},UNDECIDED_NUM_XML:9,decodeBorderLine_hashikake_XMLAnswer:function(){this.decodeCellXMLArow(function(a,b){a.setState(+b.substr(1))})},encodeBorderLine_hashikake_XMLAnswer:function(){this.encodeCellXMLArow(function(a){return"n"+a.getState()})}},AnsCheck:{checklist:["checkCellNumberNotOver","checkConnectAllNumber","checkCellNumberNotLess"],checkCellNumberNotOver:function(){this.checkAllCell(function(a){return a.isValidNum()&&a.qnum<a.getCountOfBridges()},"nmLineGt")},checkCellNumberNotLess:function(){this.checkAllCell(function(a){return a.isValidNum()&&a.qnum>a.getCountOfBridges()},"nmLineLt")}},FailCode:{nmLineGt:["数字につながる橋の数が違います。","The number of connecting bridges to a number is not correct."],nmLineLt:["数字につながる橋の数が違います。","The number of connecting bridges to a number is not correct."]}});