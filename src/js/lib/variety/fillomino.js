/*! @license pzpr.js v3.5.2 (c) 2009-2015 sabo2, MIT license
 *   https://bitbucket.org/sabo2/pzprv3 */
pzpr.classmgr.makeCustom(["fillomino"],{MouseEvent:{mouseinput:function(){this.owner.playmode&&(this.mousestart||this.mousemove)&&(this.btn.Left?this.isBorderMode()?this.inputborder():this.dragnumber_fillomino():this.btn.Right&&this.inputQsubLine()),this.mouseend&&this.notInputted()&&(this.mouseCell=this.owner.board.emptycell,this.inputqnum())},dragnumber_fillomino:function(){var a=this.getcell();if(!a.isnull&&a!==this.mouseCell){if(null===this.inputData)return this.inputData=a.getNum(),-1===this.inputData&&(this.inputData=-2),void(this.mouseCell=a);if(-2===this.inputData&&(this.inputData=-1===a.getNum()?-3:-1),this.inputData>=-1)a.setAnum(this.inputData),a.draw();else if(this.inputData<=-3){var b=this.mouseCell,c=this.owner.board.getb(a.bx+b.bx>>1,a.by+b.by>>1);-3===this.inputData&&(this.inputData=1===c.qsub?-5:-4),c.isnull||(c.setQsub(-4===this.inputData?1:0),c.draw())}this.mouseCell=a}}},KeyEvent:{enablemake:!0,enableplay:!0,moveTarget:function(a){return this.owner.playmode&&(this.isCTRL||this.isX||this.isZ)?this.move_fillomino(a):this.moveTCell(a)},move_fillomino:function(a){var b=this.cursor.getc();if(b.isnull)return!1;var c,d,e=b.adjacent,f=b.adjborder,g=b.NDIR;switch(a){case"up":c=e.top,d=f.top,g=b.UP;break;case"down":c=e.bottom,d=f.bottom,g=b.DN;break;case"left":c=e.left,d=f.left,g=b.LT;break;case"right":c=e.right,d=f.right,g=b.RT;break;default:return!1}if(!c.isnull){var h=this.isCTRL||this.isX||this.isZ;return h?(this.isCTRL?d.isnull||(d.setQsub(0===d.qsub?1:0),this.cursor.setaddr(c)):this.isZ?d.isnull||d.setQans(d.isBorder()?0:1):this.isX&&(c.isnull||(c.setAnum(b.getNum()),this.cursor.setaddr(c))),b.draw(),this.stopEvent(),!0):!1}return!1}},Board:{hasborder:1,getErrorRoomInfo:function(){for(var a=this.getRoomInfo(),b=1;b<=a.max;b++){for(var c=a.area[b],d=c.clist,e=[],f=0,g=0,h=-1,i=0;i<d.length;i++){var j=d[i].getNum();-1===j?f++:isNaN(e[j])?(g++,h=j,e[j]=1):e[j]++}if(c.number=-1,c.numkind=g,1===g)c.number=h;else if(g>=2&&0===f){for(var i=0;i<d.length;i++)a.id[d[i].id]=0;for(var i=0;i<d.length;i++)this.assignNewErrorRoomID(a,d[i]);a.area[b]=null}}return a},assignNewErrorRoomID:function(a,b){if(0===a.id[b.id]){for(var c=a.addArea(),d=[b],e=0;d.length>0;){var f=d.pop();if(0===a.id[f.id]){c.clist[e++]=f,a.id[f.id]=c.id;for(var g=f.getdir4clist(),h=0;h<g.length;h++)f.sameNumber(g[h][0])&&d.push(g[h][0])}}c.clist.length=e}}},AreaRoomManager:{enabled:!0},Graphic:{gridcolor_type:"DLIGHT",bordercolor_func:"qans",paint:function(){this.drawBGCells(),this.drawDashedGrid(),this.drawNumbers(),this.drawBorders(),this.drawBorderQsubs(),this.drawChassis(),this.drawCursor()}},Encode:{decodePzpr:function(){this.decodeNumber16()},encodePzpr:function(){this.encodeNumber16()},decodeKanpen:function(){this.owner.fio.decodeCellQnum_kanpen()},encodeKanpen:function(){this.owner.fio.encodeCellQnum_kanpen()}},FileIO:{decodeData:function(){this.decodeCellQnum(),this.decodeCellAnumsub(),this.decodeBorderAns()},encodeData:function(){this.encodeCellQnum(),this.encodeCellAnumsub(),this.encodeBorderAns()},kanpenOpen:function(){this.decodeCellQnum_kanpen(),this.decodeCellAnum_kanpen(),this.inputBorderFromNumber()},kanpenSave:function(){this.encodeCellQnum_kanpen(),this.encodeCellAnum_kanpen()},inputBorderFromNumber:function(){for(var a=this.owner.board,b=0;b<a.bdmax;b++){var c=a.border[b],d=c.sidecell[0],e=c.sidecell[1];if(c.qans=0,!d.isnull&&!e.isnull){var f=d.getNum(),g=e.getNum();-1!==f&&-1!==g&&f!==g&&(c.qans=1)}}},kanpenOpenXML:function(){this.decodeCellQnum_XMLBoard(),this.decodeCellAnum_XMLAnswer(),this.inputBorderFromNumber()},kanpenSaveXML:function(){this.encodeCellQnum_XMLBoard(),this.encodeCellAnum_XMLAnswer()},UNDECIDED_NUM_XML:0},AnsCheck:{checklist:["checkNoEmptyArea","checkSmallArea","checkSideAreaNumberSize","checkLargeArea","checkNotMultiNum","checkNoNumCell_fillomino+"],getErrorRoomInfo:function(){return this._info.eroom=this._info.eroom||this.owner.board.getErrorRoomInfo()},checkSideAreaNumberSize:function(){this.checkSideAreaSize(this.getErrorRoomInfo(),function(a){return a.number},"bsSameNum")},checkNoEmptyArea:function(){this.checkAllErrorRoom(function(a){return 0!==a.numkind},"bkNoNum")},checkSmallArea:function(){this.checkAllErrorRoom(function(a){return!(1===a.numkind&&a.number>a.clist.length)},"bkSizeLt")},checkLargeArea:function(){this.checkAllErrorRoom(function(a){return!(1===a.numkind&&a.number<a.clist.length)},"bkSizeGt")},checkNotMultiNum:function(){this.checkAllErrorRoom(function(a){return!(a.numkind>1)},"bkPlNum")},checkAllErrorRoom:function(a,b){for(var c=this.getErrorRoomInfo(),d=1;d<=c.max;d++){var e=c.area[d];if(e&&!a(e)){if(this.failcode.add(b),this.checkOnly)break;e.clist.seterr(1)}}},checkNoNumCell_fillomino:function(){this.owner.getConfig("enbnonum")||this.checkNoNumCell()}},FailCode:{bkSizeLt:["ブロックの大きさより数字のほうが大きいです。","A number is bigger than the size of block."],bkSizeGt:["ブロックの大きさよりも数字が小さいです。","A number is smaller than the size of block."],bsSameNum:["同じ数字のブロックが辺を共有しています。","Adjacent blocks have the same number."]}});