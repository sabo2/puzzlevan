/*! @license pzpr.js v3.5.2 (c) 2009-2015 sabo2, MIT license
 *   https://bitbucket.org/sabo2/pzprv3 */
pzpr.classmgr.makeCustom(["kakuru"],{MouseEvent:{mouseinput:function(){this.mousestart&&this.inputqnum_kakuru()},inputqnum_kakuru:function(){var a=this.getcell();a.isnull||1===a.ques&&a===this.cursor.getc()||this.inputqnum()}},KeyEvent:{enablemake:!0,enableplay:!0,keyinput:function(a){this.key_inputqnum_kakuru(a)},key_inputqnum_kakuru:function(a){var b=this.cursor.getc();if(a>="0"&&"9">=a||"BS"===a||"-"===a){if(1===b.ques)return;if(!this.key_inputqnum_main(b,a))return}else if(" "===a)this.owner.editmode&&b.setQues(0),b.setNum(-1);else{if(!this.owner.editmode||"q"!==a&&"q1"!==a&&"q2"!==a)return;"q"===a&&(a=1!==b.ques?"q1":"q2"),"q1"===a?(b.setQues(1),b.setNum(-1)):"q2"===a&&b.setQues(0)}this.prev=b,b.draw()}},Cell:{maxnum:function(){return this.owner.editmode?44:9}},Board:{qcols:7,qrows:7},Graphic:{gridcolor_type:"LIGHT",errbcolor1_type:"DARK",cellcolor_func:"ques",paint:function(){this.drawBGCells(),this.drawGrid(),this.drawShadedCells(),this.drawNumbers(),this.drawChassis(),this.drawCursor()},getBGCellColor:function(a){return-1!==a.qnum?"rgb(208, 208, 208)":1===a.error?this.errbcolor1:null}},Encode:{decodePzpr:function(){this.decodeKakuru()},encodePzpr:function(){this.encodeKakuru()},decodeKakuru:function(){var a=0,b=0,c=this.outbstr,d=this.owner.board;for(b=0;b<c.length;b++){var e=c.charAt(b),f=d.cell[a];if("+"===e?f.ques=1:this.include(e,"k","z")?a+=parseInt(e,36)-19:"."!==e&&(f.qnum=this.decval(e)),a++,a>=d.cellmax)break}this.outbstr=c.substr(b)},encodeKakuru:function(){for(var a="",b=0,c=this.owner.board,d=0;d<c.cellmax;d++){var e="",f=c.cell[d];1===f.ques?e="+":-1!==f.qnum?e=this.encval(f.qnum):b++,0===b?a+=e:(e||17===b)&&(a+=1===b?"."+e:(b+18).toString(36)+e,b=0)}1===b?a+=".":b>1&&(a+=(b+18).toString(36)),this.outbstr+=a},decval:function(a){return"_"===a?-2:a>="0"&&"9">=a?parseInt(a,36):a>="a"&&"j">=a?parseInt(a,36):a>="A"&&"Z">=a?parseInt(a,36)+10:-1},encval:function(a){return-2===a?"_":a>=1&&19>=a?a.toString(36).toLowerCase():a>=20&&45>=a?(a-10).toString(36).toUpperCase():"0"}},FileIO:{decodeData:function(){this.decodeCell(function(a,b){"b"===b?a.ques=1:"?"===b?a.qnum=-2:"."!==b&&(a.qnum=+b)}),this.decodeCell(function(a,b){"."!==b&&"0"!==b&&(a.anum=+b)})},encodeData:function(){this.encodeCell(function(a){return 1===a.ques?"b ":-2===a.qnum?"? ":a.qnum>=0?a.qnum+" ":". "}),this.encodeCell(function(a){return 1===a.ques||-1!==a.qnum?". ":-1!==a.anum?a.anum+" ":"0 "})}},AnsCheck:{checklist:["checkAroundPlNums","checkSumOfNumber","checkAdjacentNumbers","checkNoNumCell+"],checkAroundPlNums:function(){var a=this.owner.board;a:for(var b=0;b<a.cellmax;b++){var c=a.cell[b];if(!(1===c.ques||c.qnum<=0)){var d=c.bx,e=c.by,f={1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0},g=new this.owner.CellList,h=a.cellinside(d-2,e-2,d+2,e+2);g.add(c);for(var i=0;i<h.length;i++){var j=h[i];if(c!==j&&0===j.ques&&-1===j.qnum){var k=j.anum;k>0&&(f[k]++,g.add(j))}}for(var l=1;9>=l;l++)if(!(f[l]<=1)){if(this.failcode.add("nqAroundDup"),this.checkOnly)break a;c.seterr(1),g.filter(function(a){return a.anum===l}).seterr(1)}}}},checkSumOfNumber:function(){for(var a=this.owner.board,b=0;b<a.cellmax;b++){var c=a.cell[b];if(!(1===c.ques||c.qnum<=0)){var d=0,e=c.bx,f=c.by,g=new this.owner.CellList,h=a.cellinside(e-2,f-2,e+2,f+2);g.add(c);for(var i=0;i<h.length;i++){var j=h[i];if(c!==j&&0===j.ques&&-1===j.qnum){var k=j.anum;if(!(k>0)){d=c.qnum;break}d+=k,g.add(j)}}if(c.qnum!==d){if(this.failcode.add("nqAroundSumNe"),this.checkOnly)break;g.seterr(1)}}}},checkAdjacentNumbers:function(){for(var a=this.owner.board,b=0;b<a.cellmax;b++){var c=a.cell[b];if(!(c.anum<=0)){var d=c.bx,e=c.by,f=new this.owner.CellList,g=a.cellinside(d,e,d+2,e+2);f.add(c),g.add(a.getc(d-2,e+2));for(var h=0;h<g.length;h++){var i=g[h];c!==i&&c.anum===i.anum&&f.add(i)}if(!(f.length<=1)){if(this.failcode.add("nmAround"),this.checkOnly)break;f.seterr(1)}}}}},FailCode:{nmAround:["同じ数字がタテヨコナナメに隣接しています。","Same numbers are adjacent."],nqAroundDup:["初めから出ている数字の周りに同じ数字が入っています。","There are same numbers around the pre-numbered cell."],nqAroundSumNe:["初めから出ている数字の周りに入る数の合計が正しくありません。","A sum of numbers around the pre-numbered cell is incorrect."]}});