/*! @license pzpr.js v3.5.2-pre (c) 2009-2015 sabo2, MIT license
 *   https://bitbucket.org/sabo2/pzprv3 */
pzpr.classmgr.makeCustom(["shakashaka"],{MouseEvent:{mouseinput:function(){if(this.owner.playmode){var a=+this.owner.getConfig("use_tri");1===a?this.btn.Left?this.mousestart?this.inputTriangle_corner():this.mousemove&&null!==this.inputData&&this.inputMove():this.btn.Right&&(this.mousestart||this.mousemove)&&this.inputDot():2===a?this.btn.Left?this.mousestart?this.inputTriangle_pull_start():this.mousemove&&null===this.inputData?this.inputTriangle_pull_move():this.mousemove&&null!==this.inputData?this.inputMove():this.mouseend&&this.notInputted()&&this.inputTriangle_pull_end():this.btn.Right&&(this.mousestart||this.mousemove)&&this.inputDot():3===a&&this.mousestart&&this.inputTriangle_onebtn()}else this.owner.editmode&&this.mousestart&&this.inputqnum()},inputMove:function(){this.inputData>=2&&this.inputData<=5?this.inputTriangle_drag():(0===this.inputData||-1===this.inputData)&&this.inputDot()},inputTriangle_corner:function(){var a=this.getcell();a.isnull||a.isNum()||(this.inputData=this.checkCornerData(a),this.inputData===a.qans&&(this.inputData=0),a.setAnswer(this.inputData),this.mouseCell=a,a.draw())},checkCornerData:function(a){var b=this.inputPoint.bx-a.bx,c=this.inputPoint.by-a.by;return 0>=b?0>=c?5:2:0>=c?4:3},inputTriangle_pull_start:function(){var a=this.getcell();return a.isnull||a.isNum()?void this.mousereset():(this.firstPoint.set(this.inputPoint),void(this.mouseCell=a))},inputTriangle_pull_move:function(){var a=this.mouseCell,b=this.inputPoint.bx-this.firstPoint.bx,c=this.inputPoint.by-this.firstPoint.by,d=.33;-d>=b&&c>=d?this.inputData=2:-d>=b&&-d>=c?this.inputData=5:b>=d&&c>=d?this.inputData=3:b>=d&&-d>=c&&(this.inputData=4),null!==this.inputData&&(this.inputData===a.qans&&(this.inputData=0),a.setAnswer(this.inputData)),a.draw()},inputTriangle_pull_end:function(){var a=this.inputPoint.bx-this.firstPoint.bx,b=this.inputPoint.by-this.firstPoint.by;if(Math.abs(a)<=.1&&Math.abs(b)<=.1){var c=this.mouseCell;c.setAnswer(1!==c.qsub?-1:0),c.draw()}},inputTriangle_drag:function(){if(!(null===this.inputData||this.inputData<=0)){var a=this.getcell();if(!a.isnull&&!a.isNum()){var b=a.bx-this.mouseCell.bx,c=a.by-this.mouseCell.by,d=this.checkCornerData(a),e=null,f=this.inputData;2===b&&2===c||-2===b&&-2===c?(2===f||4===f)&&(e=f):2===b&&-2===c||-2===b&&2===c?(3===f||5===f)&&(e=f):0===b&&-2===c?((2===f||3===f)&&d!==f||(4===f||5===f)&&d===f)&&(e=[null,null,5,4,3,2][f]):0===b&&2===c?((4===f||5===f)&&d!==f||(2===f||3===f)&&d===f)&&(e=[null,null,5,4,3,2][f]):-2===b&&0===c?((3===f||4===f)&&d!==f||(2===f||5===f)&&d===f)&&(e=[null,null,3,2,5,4][f]):2===b&&0===c&&((2===f||5===f)&&d!==f||(3===f||4===f)&&d===f)&&(e=[null,null,3,2,5,4][f]),null!==e&&(a.setAnswer(e),this.inputData=e,this.mouseCell=a,a.draw())}}},inputDot:function(){var a=this.getcell();a.isnull||a.isNum()||(null===this.inputData&&(this.inputData=1===a.qsub?0:-1),a.setAnswer(this.inputData),this.mouseCell=a,a.draw())},inputTriangle_onebtn:function(){var a=this.getcell();if(!a.isnull&&!a.isNum()){var b=a.getAnswer();this.btn.Left?this.inputData=[0,2,1,3,4,5,-1][b+1]:this.btn.Right&&(this.inputData=[5,-1,1,0,2,3,4][b+1]),a.setAnswer(this.inputData),this.mouseCell=a,a.draw()}}},KeyEvent:{enablemake:!0},Cell:{numberRemainsUnshaded:!0,maxnum:4,minnum:0,getAnswer:function(){return this.isNum()?0:this.qans>0?this.qans:1===this.qsub?-1:0},setAnswer:function(a){this.isNum()||(this.setQans(a>=2&&5>=a?a:0),this.setQsub(-1===a?1:0))},isTri:function(){return 0!==this.qans}},Board:{getSlopeWareaInfo:function(){for(var a=new this.owner.AreaInfo,b=0;b<this.cellmax;b++)a.id[b]=this.cell[b].noNum()?0:null;for(var b=0;b<this.cellmax;b++){var c=this.cell[b];if(0===a.id[c.id]){for(var d=a.addArea(),e=[c],f=0;e.length>0;){var g=e.pop();if(0===a.id[g.id]){d.clist[f++]=g,a.id[g.id]=d.id;var h,i,j=g.qans,k=g.adjacent;i=k.top,i.isnull||(h=i.qans,0===a.id[i.id]&&4!==j&&5!==j&&2!==h&&3!==h&&e.push(i)),i=k.bottom,i.isnull||(h=i.qans,0===a.id[i.id]&&2!==j&&3!==j&&4!==h&&5!==h&&e.push(i)),i=k.left,i.isnull||(h=i.qans,0===a.id[i.id]&&2!==j&&5!==j&&3!==h&&4!==h&&e.push(i)),i=k.right,i.isnull||(h=i.qans,0===a.id[i.id]&&3!==j&&4!==j&&2!==h&&5!==h&&e.push(i))}}d.clist.length=f}}return a}},BoardExec:{adjustBoardData:function(a){var b=[];switch(a){case this.FLIPY:b=[0,1,5,4,3,2];break;case this.FLIPX:b=[0,1,3,2,5,4];break;case this.TURNR:b=[0,1,5,2,3,4];break;case this.TURNL:b=[0,1,3,4,5,2];break;default:return}for(var c=this.owner.board.cell,d=0;d<c.length;d++){var e=c[d],f=b[e.qans];f&&(e.qans=f)}}},Graphic:{hideHatena:!0,gridcolor_type:"LIGHT",cellcolor_func:"qnum",fontcolor:"white",fontErrcolor:"white",paint:function(){this.drawBGCells(),this.drawDotCells(!1),this.drawDashedGrid(),this.drawShadedCells(),this.drawNumbers(),this.drawTriangle(),this.drawChassis(),this.drawTarget()}},Encode:{decodePzpr:function(){this.decode4Cell()},encodePzpr:function(){this.encode4Cell()},decodeKanpen:function(){this.owner.fio.decodeCellQnumb()},encodeKanpen:function(){this.owner.fio.encodeCellQnumb()}},FileIO:{decodeData:function(){this.decodeCellQnumb(),this.decodeCellQanssub()},encodeData:function(){this.encodeCellQnumb(),this.encodeCellQanssub()},kanpenOpen:function(){this.decodeCell(function(a,b){"5"===b?a.qnum=-2:"."!==b&&(a.qnum=parseInt(b))}),this.decodeCell(function(a,b){"+"===b?a.qsub=1:"."!==b&&(a.qans=parseInt(b))})},kanpenSave:function(){this.encodeCell(function(a){return a.qnum>=0?a.qnum.toString()+" ":-2===a.qnum?"5 ":". "}),this.encodeCell(function(a){return 1===a.qsub?"+ ":a.qans>=2?a.qans.toString()+" ":". "})}},AnsCheck:{checklist:["checkOverTriangle","checkWhiteArea","checkLessTriangle"],checkOverTriangle:function(){this.checkDir4Cell(function(a){return a.isTri()},2,"nmTriangleGt")},checkLessTriangle:function(){this.checkDir4Cell(function(a){return a.isTri()},1,"nmTriangleLt")},checkWhiteArea:function(){for(var a=this.owner.board.getSlopeWareaInfo(),b=1;b<=a.max;b++){var c=a.area[b].clist,d=c.getRectSize(),e=c.filter(function(a){return 0===a.qans}).length;if(d.cols*d.rows!==e&&!this.isAreaRect_slope(a,b)){if(this.failcode.add("cuNotRectx"),this.checkOnly)break;c.seterr(1)}}},isAreaRect_slope:function(a,b){for(var c=a.area[b].clist,d=0;d<c.length;d++){var e=c[d],f=e.adjacent,g=e.qans;if((4===g||5===g)^(f.top.isnull||a.getRoomID(f.top)!==b)||(2===g||3===g)^(f.bottom.isnull||a.getRoomID(f.bottom)!==b)||(2===g||5===g)^(f.left.isnull||a.getRoomID(f.left)!==b)||(3===g||4===g)^(f.right.isnull||a.getRoomID(f.right)!==b))return!1}return!0}},FailCode:{cuNotRectx:["白マスが長方形(正方形)ではありません。","A white area is not rectangle."],nmTriangleGt:["数字のまわりにある黒い三角形の数が間違っています。","The number of triangles in four adjacent cells is bigger than it."],nmTriangleLt:["数字のまわりにある黒い三角形の数が間違っています。","The number of triangles in four adjacent cells is smaller than it."]}});