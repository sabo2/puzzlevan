/*! @license pzpr.js v3.5.2-pre (c) 2009-2015 sabo2, MIT license
 *   https://bitbucket.org/sabo2/pzprv3 */
pzpr.classmgr.makeCustom(["loute","sashigane"],{MouseEvent:{mouseinput:function(){this.owner.playmode?(this.mousestart||this.mousemove)&&(this.btn.Left&&this.isBorderMode()?this.inputborder():this.inputQsubLine()):this.owner.editmode&&(this.mousestart||this.mousemove?this.inputarrow_cell():this.mouseend&&this.notInputted()&&this.inputqnum_loute())},inputarrow_cell_main:function(a,b){a.setQdir(a.qdir!==b?b:0),a.setQnum(-1)},inputqnum_loute:function(){var a=this.getcell();a.isnull||(a!==this.cursor.getc()?this.setcursor(a):this.inputcell_loute(a))},inputcell_loute:function(a){var b=a.qdir;if(5!==b){var c=[0,5,1,2,3,4,-2],d=c.length;if(this.btn.Left){for(var e=0;d-1>=e;e++)if(b===c[e]){a.setQdir(c[d-1>e?e+1:0]);break}}else if(this.btn.Right){for(var e=d-1;e>=0;e--)if(b===c[e]){a.setQdir(c[e>0?e-1:d-1]);break}5===a.qdir&&"sashigane"===this.owner.pid&&a.setQnum(a.getmaxnum())}}else{var f,g,h=a.getNum();"sashigane"===this.owner.pid&&(g=a.getmaxnum(),f=a.getminnum()),this.btn.Left?"loute"===this.owner.pid?a.setQdir(1):f>h?a.setNum(f):g>h?a.setNum(h+1):(a.setNum(-1),a.setQdir(1)):this.btn.Right&&("loute"===this.owner.pid?a.setQdir(0):h>g?a.setNum(g):h>f?a.setNum(h-1):-1!==h?a.setNum(-1):a.setQdir(0))}a.draw()}},KeyEvent:{enablemake:!0,moveTarget:function(a){return a.match(/shift/)?!1:this.moveTCell(a)},keyinput:function(a){this.key_inputdirec(a)||("loute"===this.owner.pid?this.key_arrow_loute(a):"sashigane"===this.owner.pid&&this.key_inputqnum_sashigane(a))},key_arrow_loute:function(a){"1"===a?a="1":"2"===a?a="4":"3"===a?a="2":"4"===a?a="3":"5"===a||"q"===a?a="q":("6"===a||" "===a)&&(a=" ");var b=this.cursor.getc(),c=-1;if(a>="1"&&"4">=a)c=parseInt(a),c=b.qdir!==c?c:0;else if("-"===a)c=-2!==b.qdir?-2:0;else if("q"===a)c=5!==b.qdir?5:0;else if(" "===a)c=0;else{if("s1"!==a)return;c=-2}b.setQdir(c),this.prev=b,b.draw()},key_inputqnum_sashigane:function(a){var b=this.cursor.getc();"q"===a?(b.setQdir(5!==b.qdir?5:0),b.setQnum(-1)):"-"===a?(b.setQdir(-2!==b.qdir||-1!==b.qnum?-2:0),b.setQnum(-1)):" "===a?(b.setQdir(0),b.setQnum(-1)):(this.key_inputqnum_main(b,a),b.isNum()&&5!==b.qdir&&b.setQdir(5)),this.prev=b,b.draw()}},Cell:{maxnum:function(){var a=this.owner.board,b=this.bx,c=this.by,d=(b<a.maxbx>>1?a.maxbx-b+2:b+2)>>1,e=(c<a.maxby>>1?a.maxby-c+2:c+2)>>1;return d+e-1},minnum:function(){return(this.owner.board.qcols>=2?2:1)+(this.owner.board.qrows>=2?2:1)-1},getObjNum:function(){return this.qdir},isCircle:function(){return 5===this.qdir}},Board:{qcols:8,qrows:8,hasborder:1,getLblockInfo:function(){var a=this.getRoomInfo();a.place=[];for(var b=1;b<=a.max;b++){var c=a.area[b].clist,d=c.getRectSize(),e=this.cellinside(d.x1,d.y1,d.x2,d.y2).filter(function(c){return a.getRoomID(c)!==b}),f=e.getRectSize();if(0===e.length||f.cols*f.rows!==f.cnt||d.cols-1!==f.cols||d.rows-1!==f.rows){a.area[b].shape=0;for(var g=0;g<c.length;g++)a.place[c[g].id]=0}else{a.area[b].shape=1;for(var g=0;g<c.length;g++)a.place[c[g].id]=1;var h=null,i=null;d.x1===f.x1&&d.y1===f.y1||d.x2===f.x2&&d.y2===f.y2?(h=this.getc(d.x1,d.y2).id,i=this.getc(d.x2,d.y1).id):(d.x1===f.x1&&d.y2===f.y2||d.x2===f.x2&&d.y1===f.y1)&&(h=this.getc(d.x1,d.y1).id,i=this.getc(d.x2,d.y2).id),a.place[h]=2,a.place[i]=2;var j=null;d.x1===f.x1&&d.y1===f.y1?j=this.getc(d.x2,d.y2).id:d.x1===f.x1&&d.y2===f.y2?j=this.getc(d.x2,d.y1).id:d.x2===f.x2&&d.y1===f.y1?j=this.getc(d.x1,d.y2).id:d.x2===f.x2&&d.y2===f.y2&&(j=this.getc(d.x1,d.y1).id),a.place[j]=3}}return a}},BoardExec:{adjustBoardData:function(a,b){this.adjustNumberArrow(a,b)}},AreaRoomManager:{enabled:!0},Graphic:{gridcolor_type:"DLIGHT",bordercolor_func:"qans",globalfontsizeratio:.85,circleratio:[.4,.4],paint:function(){this.drawBGCells(),this.drawDashedGrid(),this.drawBorders(),this.drawCellArrows(),this.drawCircles(),this.drawHatenas_loute(),"sashigane"===this.owner.pid&&this.drawNumbers(),this.drawBorderQsubs(),this.drawChassis(),this.drawTarget()},getCircleStrokeColor:function(a){return a.isCircle()?this.quescolor:null},circlefillcolor_func:"null",drawHatenas_loute:function(){for(var a=this.vinc("cell_hatena","auto"),b={ratio:"sashigane"===this.owner.pid?[.8]:[.94]},c=this.range.cells,d=0;d<c.length;d++){var e=c[d];a.vid="cell_text_h_"+e.id,-2===e.qdir?(a.fillStyle=1===e.error?this.fontErrcolor:this.fontcolor,this.disptext("?",e.bx*this.bw,e.by*this.bh,b)):a.vhide()}}},"Grahpic@sashigane":{hideHatena:!0},"Encode@loute":{decodePzpr:function(){this.decodeLoute()},encodePzpr:function(){this.encodeLoute()},decodeLoute:function(){var a=0,b=0,c=this.outbstr,d=this.owner.board;for(b=0;b<c.length;b++){var e=d.cell[a],f=c.charAt(b);if(this.include(f,"0","9")||this.include(f,"a","f")?e.qdir=parseInt(f,16):"."===f?e.qdir=-2:f>="g"&&"z">=f&&(a+=parseInt(f,36)-16),a++,a>d.cellmax)break}this.outbstr=c.substr(b)},encodeLoute:function(){for(var a=0,b="",c=this.owner.board,d=0;d<c.cellmax;d++){var e="",f=c.cell[d].qdir;-2===f?e=".":0!==f?e=f.toString(16):a++,0===a?b+=e:(e||20===a)&&(b+=(15+a).toString(36)+e,a=0)}a>0&&(b+=(15+a).toString(36)),this.outbstr+=b}},"Encode@sashigane":{decodePzpr:function(){this.decodeSashigane()},encodePzpr:function(){this.encodeSashigane()},decodeSashigane:function(){var a=0,b=0,c=this.outbstr,d=this.owner.board;for(b=0;b<c.length;b++){var e=c.charAt(b),f=d.cell[a];if(this.include(e,"0","9")||this.include(e,"a","f")?(f.qdir=5,f.qnum=parseInt(e,16)):"-"===e?(f.qdir=5,f.qnum=parseInt(c.substr(b+1,2),16),b+=2):"."===e?f.qdir=5:"%"===e?f.qdir=-2:e>="g"&&"j">=e?f.qdir=parseInt(e,20)-15:e>="k"&&"z">=e&&(a+=parseInt(e,36)-20),a++,a>=d.cellmax)break}this.outbstr=c.substr(b+1)},encodeSashigane:function(){for(var a="",b=0,c=this.owner.board,d=0;d<c.cellmax;d++){var e="",f=c.cell[d].qdir,g=c.cell[d].qnum;5===f?e=g>=0&&16>g?g.toString(16):g>=16&&256>g?"-"+g.toString(16):".":-2===f?e="%":0!==f?e=(f+15).toString(20):b++,0===b?a+=e:(e||16===b)&&(a+=(b+19).toString(36)+e,b=0)}b>0&&(a+=(b+19).toString(36)),this.outbstr+=a}},FileIO:{decodeData:function(){this.decodeCell(function(a,b){"o"===b.charAt(0)?(a.qdir=5,b.length>1&&(a.qnum=parseInt(b.substr(1)))):"-"===b?a.qdir=-2:"."!==b&&(a.qdir=parseInt(b))}),this.decodeBorderAns()},encodeData:function(){var a=this.owner.pid;this.encodeCell(function(b){return"sashigane"===a&&5===b.qdir?"o"+(-1!==b.qnum?b.qnum:"")+" ":-2===b.qdir?"- ":0!==b.qdir?b.qdir+" ":". "}),this.encodeBorderAns()}},AnsCheck:{checklist:["checkArrowCorner1","checkArrowCorner2","checkCircleCorner","checkNumberAndSize+@sashigane","checkBorderDeadend","checkLblock"],getLblockInfo:function(){return this._info.lbinfo=this._info.lbinfo||this.owner.board.getLblockInfo()},checkArrowCorner1:function(){var a=this.getLblockInfo();a:for(var b=1;b<=a.max;b++)if(0!==a.area[b].shape)for(var c=a.area[b].clist,d=0;d<c.length;d++){var e=c[d],f=e.getObjNum();if(!(1>f||f>4||2===a.place[e.id])){if(this.failcode.add("arBlkEdge"),this.checkOnly)break a;c.seterr(1);break}}},checkArrowCorner2:function(){var a=this.getLblockInfo();a:for(var b=1;b<=a.max;b++)if(0!==a.area[b].shape)for(var c=a.area[b].clist,d=0;d<c.length;d++){var e=c[d],f=e.adjborder,g=e.getObjNum();if(!(1>g||g>4)&&(g===e.UP&&f.top.isBorder()||g===e.DN&&f.bottom.isBorder()||g===e.LT&&f.left.isBorder()||g===e.RT&&f.right.isBorder())){if(this.failcode.add("arNotPtCnr"),this.checkOnly)break a;c.seterr(1);break}}},checkCircleCorner:function(){var a=this.getLblockInfo();a:for(var b=1;b<=a.max;b++)if(0!==a.area[b].shape)for(var c=a.area[b].clist,d=0;d<c.length;d++){var e=c[d];if(e.isCircle()&&3!==a.place[e.id]){if(this.failcode.add("ciNotOnCnr"),this.checkOnly)break a;c.seterr(1);break}}},checkLblock:function(){for(var a=this.getLblockInfo(),b=1;b<=a.max;b++)if(0===a.area[b].shape){if(this.failcode.add("bkNotLshape"),this.checkOnly)break;a.area[b].clist.seterr(1)}}},FailCode:{bkNotLshape:["ブロックが幅1のL字型になっていません。","A block is not L-shape or whose width is not one."],arBlkEdge:["矢印がブロックの端にありません。","An arrow is not at the edge of the block."],arNotPtCnr:["矢印の先にブロックの角がありません。","An arrow doesn't indicate the corner of a block."],ciNotOnCnr:["白丸がブロックの角にありません。","A circle is out of the corner."]}});