/*! @license pzpr.js v3.5.2 (c) 2009-2015 sabo2, MIT license
 *   https://bitbucket.org/sabo2/pzprv3 */
pzpr.classmgr.makeCustom(["herugolf"],{MouseEvent:{mouseinput:function(){if(this.owner.playmode)(this.mousestart||this.mousemove)&&(this.btn.Left?this.inputMoveLine():this.btn.Right&&this.inputpeke());else if(this.owner.editmode){var a=this.getcell();this.mousestart||this.mousemove?this.btn.Right&&31!==a.ques&&-1===a.qnum&&this.inputWater():this.mouseend&&this.notInputted()&&(a.ice()||this.inputqnum_herugolf())}},inputLine:function(){this.common.inputLine.call(this),!this.owner.execConfig("autocmp")||this.owner.execConfig("dispmove")||this.notInputted()||this.inputautodark()},inputautodark:function(){var a=this.owner.opemgr,b=a.lastope;if("border"===b.group&&"line"===b.property){var c=this.owner.board.getb(b.bx,b.by),d=this.owner.board.linfo,e=new this.owner.CellList;Array.prototype.push.apply(e,c.lineedge),e=e.notnull().filter(function(a){return!!d.id[a.id]}),e.each(function(a){d.getClistByCell(a).each(function(a){a.isNum()&&a.draw()})})}},inputMoveLine:function(){if(!this.owner.execConfig("dispmove"))return void this.inputLine();var a=this.getcell();if(!a.isnull){var b=this.mouseCell,c=a.getaddr();if(this.mousestart&&a.isDestination())this.mouseCell=a,this.prevPos=c,a.draw();else if(this.mousemove&&!b.isnull&&!a.isDestination()){var d=this.getnb(this.prevPos,c);!d.isnull&&(!d.isLine()&&0===a.lcnt||d.isLine()&&1===b.lcnt)&&(d.isLine()||d.sidecell[0].distance>0||d.sidecell[1].distance>0)&&(this.mouseCell=a,this.prevPos=c,d.isLine()?d.removeLine():d.setLine(),d.draw())}}},inputWater:function(){var a=this.getcell();a.isnull||a===this.mouseCell||(null===this.inputData&&(this.inputData=a.ice()?0:6),a.setQues(this.inputData),a.drawaround(),this.mouseCell=a)},inputqnum_herugolf:function(){var a=this.getcell();if(!a.isnull){if(a!==this.cursor.getc())this.setcursor(a);else{if(this.inputcell_herugolf(a))return;0===a.ques&&this.inputqnum_main(a)}this.mouseCell=a}},inputcell_herugolf:function(a){var b=null;return 31===a.ques?this.btn.Left?b=-2:this.btn.Right&&(b=-1):0===a.ques&&-1===a.qnum?this.btn.Left&&(b=-3):-2===a.qnum&&this.btn.Right&&(b=-3),-3===b?(a.setQues(31),a.setQnum(-1),a.draw()):-1===b?(a.setQues(0),a.setQnum(-1),a.draw()):-2===b&&(a.setQues(0),a.setQnum(-2),a.draw()),null!==b}},KeyEvent:{enablemake:!0,keyinput:function(a){this.key_inputqnum_herugolf(a)},key_inputqnum_herugolf:function(a){var b=this.cursor.getc();"q"===a||"w"===a?(b.setQues(b.ice()?0:6),b.setQnum(-1)):"h"===a?(b.setQues(31===b.ques?0:31),b.setQnum(-1)):" "===a?(b.setQues(0),b.setQnum(-1)):b.ice()||this.key_inputqnum(a),this.prev=b,b.draw()}},Cell:{distance:null,isViaPoint:function(){if(null===this.distance)return!1;for(var a=this.distance,b=0;a>0;)a-=++b;return 0===a},isCmp:function(){if(this.owner.execConfig("dispmove"))return 31===this.ques&&-1!==this.base.qnum&&this.isViaPoint();if(-1!==this.qnum)for(var a=this.owner.board.linfo.getClistByCell(this),b=0,c=a.length;c>b;b++)if(a[b].base===this&&31===a[b].ques&&a[b].isViaPoint())return!0;return!1},maxnum:function(){var a=this.owner.board,b=this.bx>>1,c=this.by>>1;return Math.max(b,c,a.qcols-1-b,a.qrows-1-c)},getDestination:function(){var a=this.owner.board,b=a.linfo,c=b.id[this.id];return null!==c?b.area[c].destination:a.emptycell},getDeparture:function(){var a=this.owner.board,b=a.linfo,c=b.id[this.id];return null!==c?b.area[c].departure:a.emptycell}},Board:{hasborder:1,initialize:function(){this.common.initialize.call(this),this.waterinfo=this.addInfoList(this.owner.AreaWaterManager)}},LineManager:{isCenterLine:!0},AreaLineManager:{enabled:!0,moveline:!0,initMovedBase:function(a){for(var b=0;b<a.length;b++)a[b].distance=null;pzpr.common.AreaLineManager.prototype.initMovedBase.call(this,a)},setMovedBase:function(a){pzpr.common.AreaLineManager.prototype.setMovedBase.call(this,a);var b=this.area[a];if(b.movevalid){var c=b.departure,d=b.departure.qnum;d=d>0?d:this.owner.board.cellmax,c.distance=(d+1)*d/2;for(var e=+{1:1,2:2,4:3,8:4}[15&this.linkinfo[c.id]],f=c.getaddr(),g=c.distance;;){f.movedir(e,2);var c=f.getc(),h=c.adjborder;if(c.isnull||c.lcnt>=3||0===c.lcnt)break;if(c.distance=--g,c===b.destination)break;1!==e&&h.bottom.isLine()?e=2:2!==e&&h.top.isLine()?e=1:3!==e&&h.right.isLine()?e=4:4!==e&&h.left.isLine()&&(e=3)}}}},"AreaWaterManager:AreaManager":{enabled:!0,relation:["cell"],isvalid:function(a){return a.ice()}},Flags:{autocmp:"number"},Graphic:{hideHatena:!0,gridcolor_type:"LIGHT",globalfontsizeratio:.85,bgcellcolor_func:"icebarn",bordercolor_func:"ice",circlefillcolor_func:"qcmp",invalidlinecolor:"silver",paint:function(){this.drawBGCells(),this.drawDashedGrid(),this.drawBorders(),this.drawTip_herugolf(),this.drawViaPoints(),this.drawLines(),this.drawCircles(),this.drawNumbers(),this.drawHoles(),this.drawPekes(),this.drawChassis(),this.drawTarget()},drawNumber1:function(a){var b=this.context,c=this.getCircleCaption(a);b.vid="cell_text_"+a.id,c?(b.fillStyle=this.getCellNumberColor(a),this.disptext(c,a.bx*this.bw,a.by*this.bh)):b.vhide()},getCircleCaption:function(a){if(this.owner.execConfig("dispmove")){if(!a.isDestination()||a.base.qnum<0)return"";for(var b=a.distance,c=0;b>0;)b-=++c;return""+c}var d=a.getNum();return d>=0?""+d:""},getLineColor:function(a){if(this.addlw=0,a.isLine()){var b=a.error||a.qinfo;if(1===b)return this.addlw=1,this.errlinecolor;if(-1===b)return this.errlinebgcolor;var c=a.sidecell,d=c[0].distance>=0&&c[1].distance>=0;return this.owner.execConfig("dispmove")?d?this.movelinecolor:this.errlinecolor:d?this.linecolor:this.invalidlinecolor}return null},drawTip_herugolf:function(){for(var a=this.vinc("cell_linetip","auto"),b=.3*this.cw,c=.05*this.cw,d=this.range.cells,e=0;e<d.length;e++){var f=d[e],g=0,h=null;if(-1===f.qnum&&!this.owner.execConfig("dispmove")){var i=f.adjacent,j=f.adjborder;j.top.isLine()&&(1===f.lcnt||f.isViaPoint()&&i.top.distance===f.distance+1)?(g=2,h=j.top):j.bottom.isLine()&&(1===f.lcnt||f.isViaPoint()&&i.bottom.distance===f.distance+1)?(g=1,h=j.bottom):j.left.isLine()&&(1===f.lcnt||f.isViaPoint()&&i.left.distance===f.distance+1)?(g=4,h=j.left):j.right.isLine()&&(1===f.lcnt||f.isViaPoint()&&i.right.distance===f.distance+1)&&(g=3,h=j.right)}if(a.vid="c_tip_"+f.id,0!==g){a.lineWidth=this.lw;var k=h.error||h.qinfo;1===k?(a.strokeStyle=this.errlinecolor,a.lineWidth=a.lineWidth+1):a.strokeStyle=-1===k?this.errlinebgcolor:f.distance>=0?this.linecolor:this.invalidlinecolor,a.beginPath();var l=f.bx*this.bw+1,m=f.by*this.bh+1;1===g?a.setOffsetLinePath(l,m,-b,b,0,-c,b,b,!1):2===g?a.setOffsetLinePath(l,m,-b,-b,0,c,b,-b,!1):3===g?a.setOffsetLinePath(l,m,b,-b,-c,0,b,b,!1):4===g&&a.setOffsetLinePath(l,m,-b,-b,c,0,-b,b,!1),a.stroke()}else a.vhide()}},drawHoles:function(){var a=this.vinc("cell_hole","auto");a.fillStyle=this.fontcolor;for(var b={globalratio:1},c=this.owner.execConfig("dispmove"),d=this.range.cells,e=0;e<d.length;e++){var f=d[e];a.vid="cell_hole_text_"+f.id,31!==f.ques||c&&f.isDestination()?a.vhide():this.disptext("H",f.bx*this.bw,f.by*this.bh,b)}},drawViaPoints:function(){var a=this.vinc("cell_via","auto",!0);a.fillStyle=this.movelinecolor;for(var b=.15*this.cw,c=this.owner.execConfig("dispmove"),d=this.range.cells,e=0;e<d.length;e++){var f=d[e];a.vid="c_dcir_"+f.id,c&&f.isViaPoint()?a.fillCircle(f.bx*this.bw,f.by*this.bh,b):a.vhide()}}},Encode:{decodePzpr:function(){this.decodeIce(),this.decodeNumber16_herugolf()},encodePzpr:function(){this.encodeIce(),this.encodeNumber16_herugolf()},decodeNumber16_herugolf:function(){var a=0,b=0,c=this.outbstr,d=this.owner.board;for(b=0;b<c.length;b++){var e=d.cell[a],f=c.charAt(b);if(this.include(f,"0","9")||this.include(f,"a","f")?e.qnum=parseInt(f,16):"-"===f?(e.qnum=parseInt(c.substr(b+1,2),16),b+=2):"h"===f?e.ques=31:f>="i"&&"z">=f&&(a+=parseInt(f,36)-18),a++,a>=d.cellmax)break}this.outbstr=c.substr(b+1)},encodeNumber16_herugolf:function(){for(var a=0,b="",c=this.owner.board,d=0;d<c.cellmax;d++){var e="",f=c.cell[d],g=f.qnum,h=f.ques;-2===g?e=".":g>=0&&16>g?e=g.toString(16):g>=16&&256>g?e="-"+g.toString(16):31===h?e="h":a++,0===a?b+=e:(e||18===a)&&(b+=(17+a).toString(36)+e,a=0)}a>0&&(b+=(17+a).toString(36)),this.outbstr+=b}},FileIO:{decodeData:function(){this.decodeCell(function(a,b){"H"===b?a.ques=31:"i"===b?a.ques=6:"."!==b&&(a.qnum=+b)}),this.decodeBorderLine()},encodeData:function(){this.encodeCell(function(a){return 31===a.ques?"H ":6===a.ques?"i ":a.qnum>0?a.qnum+" ":". "}),this.encodeBorderLine()}},AnsCheck:{checklist:["checkBranchLine","checkCrossLine","checkConnectObject","checkLineOverLetter","checkLineOverHole","checkCurveHalfway","checkMoveOver","checkStopHalfway","checkWaterHazard","checkCupIn+","checkIgnoredHole+","checkDisconnectLine"],checkMoveOver:function(){for(var a=!0,b=this.owner.board,c=0;c<b.bdmax;c++){var d=b.border[c];if(d.isLine()){var e=d.sidecell[0],f=d.sidecell[1];if(!(e.distance>=0&&f.distance>=0)){if(a=!1,this.checkOnly)break;d.seterr(1),(this.owner.execConfig("dispmove")?e.getDestination():e.getDeparture()).seterr(1)}}}a||(this.failcode.add("laMoveOver"),b.border.setnoerr())},checkLineOverHole:function(){this.checkAllCell(function(a){return 31===a.ques&&a.lcnt>=2},"laOnHole")},checkStopHalfway:function(){this.checkAllCell(function(a){return 1===a.lcnt&&a.distance>=0&&!a.isViaPoint()},"laLenNe")},checkCurveHalfway:function(){this.checkAllCell(function(a){return a.isLineCurve()&&!a.isViaPoint()},"laCurve")},checkWaterHazard:function(){this.checkAllCell(function(a){return 6===a.ques&&a.isViaPoint()},"laWaterHazard")},checkCupIn:function(){this.owner.execConfig("dispmove")?this.checkAllCell(function(a){return 31!==a.ques&&a.isDestination()},"nmOutOfHole"):this.checkAllCell(function(a){return-1!==a.qnum&&31!==a.getDestination().ques},"nmOutOfHole")},checkIgnoredHole:function(){this.checkAllCell(function(a){return 31===a.ques&&!a.isDestination()},"nmIgnored")}},FailCode:{laIsolate:["ボールにつながっていない線があります。","A line doesn't connect any ball."],laOnNum:["ボールの上を線が通過しています。","A line goes through a ball."],laOnHole:["ホールの上を線が通過しています。","A line goes through a hole."],laCurve:["ボールが移動途中に曲がっています。","A ball curves halfway."],laLenNe:["ボールが移動途中に止まっています。","A ball stops halfway."],laMoveOver:["ボールが指示された打数を超えて動いています。","You make a bogey or more."],laWaterHazard:["ウォーターハザードになっています。","There is a water hazaad ball."],nmConnected:["ボールが繋がっています。","There are connected balls."],nmOutOfHole:["ホールに入っていないボールがあります。","A ball doesn't cup in."],nmIgnored:["ボールの入っていないホールがあります。","There is a Hole without a ball."]}});